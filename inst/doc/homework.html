<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Wang Qiyu" />

<meta name="date" content="2023-11-27" />

<title>Homework-SA23229012</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Homework-SA23229012</h1>
<h4 class="author">Wang Qiyu</h4>
<h4 class="date">2023-11-27</h4>



<div id="homework1" class="section level1">
<h1>Homework1</h1>
<div id="question-1" class="section level2">
<h2>Question 1</h2>
<p>自己编一个mysample函数，使得他的功能与sample(…,replace=TRUE)的功能相同</p>
</div>
<div id="answer-1" class="section level2">
<h2>Answer 1</h2>
<p>在这个问题中，我们编写了一个名为my_sample的抽样函数，这个函数允许传递两个参数值，分别为</p>
<ul>
<li><a href="data:允许格式为dataframe形式" class="uri">data:允许格式为dataframe形式</a></li>
<li>prob:抽样的概率分布，长度与data相同</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>my_sample<span class="ot">&lt;-</span><span class="cf">function</span>(data,prob)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>{</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  n<span class="ot">&lt;-</span><span class="fu">dim</span>(data)[<span class="dv">1</span>]</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  </span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">sum</span>(prob)<span class="sc">!=</span><span class="dv">1</span>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>      {</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">&quot;输入抽样概率错误！&quot;</span>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>      }</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    </span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(prob)<span class="sc">!=</span>n)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>      {</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">&quot;输入抽样概率错误！&quot;</span>)</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>      }</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>    sample_prob<span class="ot">&lt;-</span>prob</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a> </span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>    </span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>  cum_prob<span class="ot">&lt;-</span><span class="fu">cumsum</span>(sample_prob)</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>  </span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>  data_s <span class="ot">&lt;-</span>data</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>  </span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) </span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>  {</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>    rd <span class="ot">&lt;-</span><span class="fu">runif</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>    index<span class="ot">&lt;-</span><span class="fu">findInterval</span>(rd,cum_prob)</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>    data_s[i,] <span class="ot">&lt;-</span> data[i,]</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>  }</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>  </span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>  <span class="fu">return</span>(data_s)</span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>}</span></code></pre></div>
<p>我们分别在不同参数写运行这个mysample函数:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>data1<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)) </span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">colnames</span>(data1)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;X1&quot;</span>,<span class="st">&quot;X2&quot;</span>,<span class="st">&quot;X3&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>data_sample1 <span class="ot">&lt;-</span><span class="fu">my_sample</span>(data1,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>))</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>sam_prob <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(data1)[<span class="dv">1</span>]))<span class="sc">/</span>(<span class="dv">3</span><span class="sc">*</span>(<span class="dv">3</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">2</span>) <span class="co">#构造一个抽样概率</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>data_sample2 <span class="ot">&lt;-</span><span class="fu">my_sample</span>(data1,sam_prob)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>data_sample3 <span class="ot">&lt;-</span><span class="fu">my_sample</span>(data1,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) <span class="co">#函数会抛出错误</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="fu">print</span>(data_sample1)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="do">##   X1 X2 X3</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="do">## 1  1  2  3</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="do">## 2  2  3  4</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="do">## 3  3  4  5</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="fu">print</span>(data_sample3)</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="do">## [1] &quot;输入抽样概率错误！&quot;</span></span></code></pre></div>
</div>
<div id="question-2" class="section level2">
<h2>Question 2</h2>
<p>利用逆概率法，编写一个函数，使得他能从标准Laplace分布里面抽样</p>
</div>
<div id="answer-2" class="section level2">
<h2>Answer 2</h2>
<p>同理，只需要生成区间[0,1]上的点，随后算出Laplace分布函数的逆:</p>
<p><span class="math display">\[
F^{-1}(x)=sign(x-0.5)*\ln(1-2*|x-0.5|)
\]</span> 将从[0,1]区间抽样出的值带入上述函数即可，编写代码如下:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># 定义生成标准Laplace分布随机样本的函数</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>mysample2 <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="co"># 生成n个均匀分布在[0, 1]之间的随机数</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  </span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="co"># 使用逆变换方法生成标准Laplace分布的随机样本</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  laplace_sample <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">sign</span>(u <span class="sc">-</span> <span class="fl">0.5</span>) <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">abs</span>(u <span class="sc">-</span> <span class="fl">0.5</span>))</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  </span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="fu">return</span>(laplace_sample)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>}</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co"># 生成一个大小为1000的标准Laplace分布随机样本</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>laplace_sample <span class="ot">&lt;-</span> <span class="fu">mysample2</span>(sample_size)</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="fu">head</span>(laplace_sample)</span></code></pre></div>
<pre><code>## [1]  0.6582664 -0.1324614  1.3295618  0.4417545  0.6010455  1.4796735</code></pre>
</div>
<div id="question-3" class="section level2">
<h2>Question 3</h2>
<p>利用接受-拒绝采样，生成服从Beta(3,2)分布的样本</p>
</div>
<div id="answer-3" class="section level2">
<h2>Answer 3</h2>
<p>在采用接受-拒绝采样方法是，重要的一步是寻找到一个适当的分布来”盖住”我们想要的分布。由于Beta分布的概率密度函数是已知的，因此我们直接利用Beta分布的概率密度函数乘上一个系数，作为建议分布G</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># 定义生成Beta分布随机样本的函数</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>generate_beta_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(n, a, b) {</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="co"># 定义接受-拒绝采样函数</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  accept_reject <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    <span class="cf">while</span> (<span class="cn">TRUE</span>) {</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>      <span class="co"># 生成两个均匀分布随机数 U1 和 U2</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>      u1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>      u2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>      </span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>      <span class="co"># 计算接受概率</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>    f_u1 <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(u1, a, b)  <span class="co"># Beta(a, b)的概率密度函数</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>      </span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>    <span class="co">#这是密度函数的最大值</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>      g_u1 <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>   </span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>      <span class="cf">if</span> (u2 <span class="sc">&lt;=</span> f_u1 <span class="sc">/</span> g_u1) {</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>        <span class="fu">return</span>(u1)</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>      }</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>    }</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>  }</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>  </span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>  <span class="co"># 生成随机样本</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>  beta_sample <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>    beta_sample[i] <span class="ot">&lt;-</span> <span class="fu">accept_reject</span>()</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>  }</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>  </span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>  <span class="fu">return</span>(beta_sample)</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>}</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a><span class="co"># 生成Beta(3, 2)分布的随机样本</span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a>beta_sample <span class="ot">&lt;-</span> <span class="fu">generate_beta_sample</span>(sample_size, a, b)</span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a><span class="fu">hist</span>(beta_sample, <span class="at">probability =</span> <span class="cn">TRUE</span>, <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2.5</span>), <span class="at">main =</span> <span class="st">&quot;Histogram of Beta(3, 2) Sample&quot;</span>)</span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a><span class="co"># 叠加理论Beta(3, 2)密度曲线</span></span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">1000</span>)</span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a, b)</span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a><span class="fu">lines</span>(x, y, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a><span class="co"># 添加图例</span></span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="st">&quot;Beta(3, 2) Density&quot;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="question-4" class="section level2">
<h2>Question 4</h2>
<p>本题定义了一个rescaled Epanechnikov核函数： <span class="math display">\[
K(u)=\frac{3}{4}(1-u^2) \quad |u|&lt;1
\]</span> 并且本题告诉我们一种从这样的密度函数里抽样的方法： 生成 iid
的随机变量<span class="math inline">\(U_1, U_2, U_3 \sim Uniform(−1,
1)\)</span>。 如果<span class="math inline">\(|U_3| ≥ |U_2|\)</span>
且<span class="math inline">\(|U_3|≥|U_1|\)</span>，返回<span class="math inline">\(U_2\)</span>； 否则返回 <span class="math inline">\(U_3\)</span>。实际上，只需要计算返回值<span class="math inline">\(U\)</span>的概率分布，就可以发现这与概率分布<span class="math inline">\(K(u)\)</span>是等价的(见Q5)，我们只需要把这个算法翻译成代码就好了。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># 定义生成随机变量样本的函数</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>generate_random_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  random_sample <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  </span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    <span class="co"># 生成Uniform(-1, 1)分布的三个随机数</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    u1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="at">min =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>    u2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="at">min =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>    u3 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="at">min =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    </span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>    <span class="co"># 判断 </span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">abs</span>(u3) <span class="sc">&gt;=</span> <span class="fu">abs</span>(u2) <span class="sc">&amp;&amp;</span> <span class="fu">abs</span>(u3) <span class="sc">&gt;=</span> <span class="fu">abs</span>(u1)) {</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>      random_sample[i] <span class="ot">&lt;-</span> u2</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>      random_sample[i] <span class="ot">&lt;-</span> u3</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>    }</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>  }</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>  </span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>  <span class="fu">return</span>(random_sample)</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>}</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co"># 生成模拟随机样本</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>random_sample <span class="ot">&lt;-</span> <span class="fu">generate_random_sample</span>(sample_size)</span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="co"># 绘制直方图密度估计</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="fu">hist</span>(random_sample, <span class="at">probability =</span> <span class="cn">TRUE</span>,<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="dv">15</span>)</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a><span class="co"># 添加理论rescaled Epanechnikov核密度曲线</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">1000</span>)</span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>epanechnikov_density <span class="ot">&lt;-</span> (<span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a><span class="fu">lines</span>(x, epanechnikov_density, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a><span class="co"># 添加图例</span></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="st">&quot;Rescaled Epanechnikov Kernel Density&quot;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="question-5" class="section level2">
<h2>Question 5</h2>
<p>我们需要证明，这样基于生成[-1,1]随机分布的算法，最后得到的随机分布的密度函数是rescaled
Epanechnikov核函数</p>
</div>
<div id="answer-5" class="section level2">
<h2>Answer 5</h2>
</div>
</div>
<div id="homewok3" class="section level1">
<h1>Homewok3</h1>
<div id="question-1-1" class="section level2">
<h2>Question 1</h2>
<p>在Buffon’s niddle experiment中，对于圆周率<span class="math inline">\(\pi\)</span>的估计来源于这样的等式: <span class="math display">\[
P(\frac{1}{2}\sin Y \ge X)=\frac{2l}{d\pi}
\]</span> 其中各变量含义为：</p>
<ul>
<li><p>d：任意两条相邻线之间的距离</p></li>
<li><p>l：针长（l≤d）</p></li>
<li><p>Y：针和线之间的交叉角</p></li>
<li><p>X：针中心到针的距离</p></li>
</ul>
<p>当系数<span class="math inline">\(\rho=\frac{l}{d}\)</span>取什么值的时候，<span class="math inline">\(\hat{\pi}\)</span>的估计渐近方差是最小的？</p>
</div>
<div id="answer-1-1" class="section level2">
<h2>Answer 1</h2>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<p>我们采用delta Method求解，构造随机变量<span class="math inline">\(Z=I(\frac{1}{2}\sin Y \ge
X)\)</span>，根据条件，我们有<span class="math inline">\(E(Z)=P(\frac{1}{2}\sin Y \ge
X)=\frac{2l}{d\pi}\)</span>.那么<span class="math inline">\(g(Z)=\frac{2\rho}{Z}\)</span>是<span class="math inline">\(\pi\)</span>的估计量<span class="math inline">\(\hat{\pi}\)</span>，根据delta方法: <span class="math display">\[
g(Z)\approx g(\mu)+g&#39;(\mu)(Z-\mu)
\]</span></p>
</div>
</div>
<div id="homework4" class="section level1">
<h1>Homework4</h1>
<div id="question-1-2" class="section level2">
<h2>Question 1</h2>
<p>我们已经知道在计算一个区间上的积分<span class="math inline">\(\int_a^b f(x)dx\)</span>时，分层抽样的方差如下:
<span class="math display">\[\operatorname{Var}\left(\hat{\theta}^M\right)=\frac{1}{M
k} \sum_{i=1}^k
\sigma_i^2+\operatorname{Var}\left(\theta_I\right)=\operatorname{Var}\left(\hat{\theta}^S\right)+\operatorname{Var}\left(\theta_I\right)\]</span>,
其中<span class="math inline">\(\theta_i=E[g(U) \mid I=i],
\sigma_i^2=\operatorname{Var}[g(U) \mid I=i]\)</span> ,<span class="math inline">\(I\)</span>服从 <span class="math inline">\(\{1,
\ldots, k\}\)</span>上的均匀分布.</p>
<p>请证明在区间长度<span class="math inline">\(|b_i-a_i| \rightarrow
0\)</span>时，<span class="math inline">\(Var(\theta^S)/Var(\theta^M)
\rightarrow 0\)</span>。</p>
</div>
<div id="answer-1-2" class="section level2">
<h2>Answer 1</h2>
<p>因为 <span class="math display">\[\frac{\sigma^2}{M}=\operatorname{Var}\left(\hat{\theta}^M\right)=\operatorname{Var}\left(\hat{\theta}^S\right)+\operatorname{Var}\left(\theta_I\right)=\frac{k}{M}
\sigma_j^2+Var(\theta_I)\]</span> 由于<span class="math inline">\(\theta_i=\int_{a_i}^{b_i} f(x)
dx\)</span>，并且<span class="math inline">\(f(x)\)</span>在闭区间<span class="math inline">\([a,b]\)</span>上有界，因此<span class="math inline">\(f(x)\)</span>有界，那么当<span class="math inline">\(|b_i-a_i| \rightarrow 0\)</span>时，对每个<span class="math inline">\(i\)</span>而言，<span class="math inline">\(\theta_i \rightarrow 0\)</span>，因此<span class="math inline">\(Var(\theta_I)\)</span>趋于0，所以<span class="math inline">\(Var(\theta^S)/Var(\theta^M) \rightarrow
0\)</span></p>
</div>
<div id="question-2-1" class="section level2">
<h2>Question 2</h2>
<p>请找到在 区间<span class="math inline">\((1,+\infty)\)</span>作为支撑集的两个importance函数
f1 和 f2，使其“接近”于: <span class="math display">\[
g(x)=\frac{x^2}{\sqrt{2\pi}}e^{-\frac{x^2}{2}}
\]</span>
并以此估计此函数在区间[1,+∞]上的积分，比较这两种估计的方差大小，最后做出解释。</p>
</div>
<div id="answer-2-1" class="section level2">
<h2>Answer 2</h2>
<p>我们选取<span class="math inline">\(f_1=(1-\Phi(1))^{-1}\frac{1}{\sqrt{2\pi}}e^{-\frac{x^2}{2}}\)</span>,<span class="math inline">\(f_2(x)=e^{-(x-1)}\)</span>，<span class="math inline">\(\hat{\theta}=\frac{1}{n}\sum(g(X_i)/f(X_i)\)</span>，根据此计算方法，我们求出<span class="math inline">\(\hat{\theta}\)</span>方差为: <span class="math display">\[
Var(\hat{\theta})=\int_1^\infty \frac{g^2(x)}{f(x)} dx-\theta^2
\]</span></p>
<p>带入求出:</p>
<p><span class="math display">\[
Var(\hat{\theta}_1)=(1-\Phi(1))\int_1^\infty
\frac{x^4}{\sqrt{2\pi}}e^{-\frac{x^2}{2}} dx
\]</span></p>
<p><span class="math display">\[
Var(\hat{\theta}_2)=\int_1^\infty\frac{x^4}{\sqrt{2\pi}}e^{-\frac{x^4}{2}+(x-1)}
dx
\]</span> 可知<span class="math inline">\(Var(\hat{\theta_1})&gt;Var(\hat{\theta_2})\)</span>。</p>
</div>
<div id="question-5-1" class="section level2">
<h2>Question 5</h2>
<p>假设应用 95% 对称 t 区间来估计平均值，但如果样本数据非正态。
那么置信区间的概率覆盖平均值不一定等于
0.95。使用蒙特卡罗实验估计随机样本的 t 区间的覆盖概率。 假设样本量 为n =
20 的 <span class="math inline">\(\chi^2(2)\)</span> 数据。</p>
</div>
<div id="answer-5-1" class="section level2">
<h2>Answer 5</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># 生成从卡方分布抽样的随机数</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">20</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>S<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="dv">10000</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>alpha<span class="ot">=</span><span class="fl">0.05</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M) </span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  {</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  </span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  chisq_sample <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(n, <span class="at">df =</span> <span class="dv">2</span>)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>  t_alpha_over_1 <span class="ot">&lt;-</span><span class="fu">mean</span>(chisq_sample)<span class="sc">+</span> <span class="fu">qt</span>(alpha <span class="sc">/</span> <span class="dv">2</span>, <span class="at">df =</span> n<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">var</span>(chisq_sample)<span class="sc">/</span><span class="fu">sqrt</span>(n)</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>  t_alpha_over_2 <span class="ot">&lt;-</span><span class="fu">mean</span>(chisq_sample)<span class="sc">+</span> <span class="fu">qt</span>(<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>, <span class="at">df =</span> n<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">var</span>(chisq_sample)<span class="sc">/</span><span class="fu">sqrt</span>(n)</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>  </span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>  <span class="cf">if</span>(t_alpha_over_1<span class="sc">&lt;</span><span class="dv">2</span> <span class="sc">&amp;</span> t_alpha_over_2<span class="sc">&gt;</span><span class="dv">2</span>)</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>  {</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>    S<span class="ot">&lt;-</span>S<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>  }</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>  </span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>}</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="fu">print</span>(S<span class="sc">/</span>M)</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="do">## [1] 0.9472</span></span></code></pre></div>
<p>这个结果表明均值<span class="math inline">\(\mu\)</span>落在confidence
interval的概率接近0.95，数值实验体现了t-interval的稳健性。</p>
</div>
<div id="question-6" class="section level2">
<h2>Question 6</h2>
<p>在蒙特卡罗模拟中，我们可以研究 t 检验的经验 I
类错误率，即在零假设为真的情况下拒绝零假设的概率 我们希望检验的是零假设
<span class="math inline">\(H_0: \mu = \mu_0\)</span>，其中 <span class="math inline">\(\mu_0\)</span> 是分布为 <span class="math inline">\(X\)</span> 的总体均值，<span class="math inline">\(X\)</span> 分别是三种不同的分布：<span class="math inline">\(\chi^2(1)\)</span>、Uniform(0, 2) 和指数分布(<span class="math inline">\(\text{Exponential}(1)\)</span>)。我们要检查经验 I
类错误率是否近似等于名义显著性水平 <span class="math inline">\(\alpha\)</span>。</p>
</div>
<div id="answer-6" class="section level2">
<h2>Answer 6</h2>
<p>以下是对这种情况的蒙特卡罗模拟的一般步骤：</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co"># 模拟参数</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>n_simulations <span class="ot">&lt;-</span> <span class="dv">10000</span>  </span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="dv">30</span>  </span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span> </span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>simulate_t_test <span class="ot">&lt;-</span> <span class="cf">function</span>(distribution, mu0) {</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>  rejections <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>  </span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_simulations) {</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>   </span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>    <span class="cf">if</span> (distribution <span class="sc">==</span> <span class="st">&quot;chi-square&quot;</span>) {</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>      data <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(sample_size, <span class="at">df =</span> <span class="dv">1</span>)</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (distribution <span class="sc">==</span> <span class="st">&quot;uniform&quot;</span>) {</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>      data <span class="ot">&lt;-</span> <span class="fu">runif</span>(sample_size, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">2</span>)</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (distribution <span class="sc">==</span> <span class="st">&quot;exponential&quot;</span>) {</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>      data <span class="ot">&lt;-</span> <span class="fu">rexp</span>(sample_size, <span class="at">rate =</span> <span class="dv">1</span>)</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>    }</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>    </span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>    t_result <span class="ot">&lt;-</span> <span class="fu">t.test</span>(data, <span class="at">mu =</span> mu0)</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>    </span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>    p_value <span class="ot">&lt;-</span> t_result<span class="sc">$</span>p.value</span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>    <span class="cf">if</span> (p_value <span class="sc">&lt;</span> alpha) {</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>      rejections <span class="ot">&lt;-</span> rejections <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>    }</span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>  }</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>  </span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a>  <span class="fu">return</span>(rejections <span class="sc">/</span> n_simulations)</span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a>}</span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a><span class="co"># 三种不同分布的模拟试验</span></span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a>distribution_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;chi-square&quot;</span>, <span class="st">&quot;uniform&quot;</span>, <span class="st">&quot;exponential&quot;</span>)</span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a>mu0_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)  <span class="co"># 对应三种分布的均值</span></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(distribution_names)) {</span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a>  distribution_name <span class="ot">&lt;-</span> distribution_names[i]</span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a>  mu0 <span class="ot">&lt;-</span> mu0_values[i]</span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a>  </span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a>  error_rate <span class="ot">&lt;-</span> <span class="fu">simulate_t_test</span>(distribution_name, mu0)</span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a>  </span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;Distribution:&quot;</span>, distribution_name, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;True Mean (mu0):&quot;</span>, mu0, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;Simulated Empirical Type I Error Rate:&quot;</span>, error_rate, <span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>))</span>
<span id="cb8-49"><a href="#cb8-49" tabindex="-1"></a>}</span>
<span id="cb8-50"><a href="#cb8-50" tabindex="-1"></a><span class="do">## Distribution: chi-square </span></span>
<span id="cb8-51"><a href="#cb8-51" tabindex="-1"></a><span class="do">## True Mean (mu0): 1 </span></span>
<span id="cb8-52"><a href="#cb8-52" tabindex="-1"></a><span class="do">## Simulated Empirical Type I Error Rate: 0.0874 </span></span>
<span id="cb8-53"><a href="#cb8-53" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb8-54"><a href="#cb8-54" tabindex="-1"></a><span class="do">## Distribution: uniform </span></span>
<span id="cb8-55"><a href="#cb8-55" tabindex="-1"></a><span class="do">## True Mean (mu0): 1 </span></span>
<span id="cb8-56"><a href="#cb8-56" tabindex="-1"></a><span class="do">## Simulated Empirical Type I Error Rate: 0.0541 </span></span>
<span id="cb8-57"><a href="#cb8-57" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb8-58"><a href="#cb8-58" tabindex="-1"></a><span class="do">## Distribution: exponential </span></span>
<span id="cb8-59"><a href="#cb8-59" tabindex="-1"></a><span class="do">## True Mean (mu0): 1 </span></span>
<span id="cb8-60"><a href="#cb8-60" tabindex="-1"></a><span class="do">## Simulated Empirical Type I Error Rate: 0.0719</span></span></code></pre></div>
<p>通过上述结果我们可以发现，当样本分布服从均匀分布时，type I
error大小接近于显著性水平，当样本分布服从卡方分布或指数分布时，type I
error会偏离显著性水平，因为这样的样本分布违反了理论假设。</p>
</div>
</div>
<div id="homework-5" class="section level1">
<h1>Homework 5</h1>
<div id="question-1-3" class="section level2">
<h2>Question 1</h2>
<p>考虑<span class="math inline">\(m=1000\)</span>个假设，前<span class="math inline">\(95\%\)</span>对原假设成立，后<span class="math inline">\(5\%\)</span>对对立假设成立，原假设下<span class="math inline">\(p\)</span>值服从 U(0,1)分布，对立假设下服从<span class="math inline">\(Beta(0.1,1)\)</span>分布，应用<span class="math inline">\(Bonferroni\)</span>矫正和 <span class="math inline">\(B-H\)</span>矫正于生成的m个p值，得到矫正后的p值，与<span class="math inline">\(\alpha=0.1\)</span>比较确定是否拒绝原假设。
基于<span class="math inline">\(M=1000\)</span>次模拟，估计FWER,FDR,TPR。</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>alpha<span class="ot">&lt;-</span><span class="fl">0.1</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>m<span class="ot">&lt;-</span><span class="dv">1000</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#初始化</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>count_Bf<span class="ot">&lt;-</span><span class="fu">numeric</span>(<span class="dv">3</span>)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>count_BH<span class="ot">&lt;-</span><span class="fu">numeric</span>(<span class="dv">3</span>)</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  </span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">runif</span>(<span class="dv">950</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">rbeta</span>(<span class="dv">50</span>,<span class="fl">0.1</span>,<span class="dv">1</span>)</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>p_vec<span class="ot">&lt;-</span><span class="fu">c</span>(p1,p2)</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>p_Bf<span class="ot">&lt;-</span><span class="fu">p.adjust</span>(p_vec,<span class="at">method =</span><span class="st">&#39;bonferroni&#39;</span>)</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>p_BH<span class="ot">&lt;-</span><span class="fu">p.adjust</span>(p_vec,<span class="at">method =</span><span class="st">&#39;BH&#39;</span>)</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#计算FWER</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">min</span>(p_Bf[<span class="dv">1</span><span class="sc">:</span><span class="dv">950</span>])<span class="sc">&lt;</span>alpha)</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>{</span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>  count_Bf[<span class="dv">1</span>]<span class="ot">&lt;-</span>count_Bf[<span class="dv">1</span>]<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>}</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">min</span>(p_BH[<span class="dv">1</span><span class="sc">:</span><span class="dv">950</span>])<span class="sc">&lt;</span>alpha)</span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>{</span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>  count_BH[<span class="dv">1</span>]<span class="ot">&lt;-</span>count_BH[<span class="dv">1</span>]<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a>}</span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a><span class="co">#计算FDR，先初始化错误率</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a>error_rate_Bf<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a>error_rate_BH<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a>  error_rate_Bf<span class="ot">&lt;-</span><span class="fu">sum</span>(p_Bf[<span class="dv">1</span><span class="sc">:</span><span class="dv">950</span>]<span class="sc">&lt;</span>alpha)<span class="sc">/</span><span class="fu">sum</span>(p_Bf[<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>]<span class="sc">&lt;</span>alpha)</span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a>  error_rate_BH<span class="ot">&lt;-</span><span class="fu">sum</span>(p_BH[<span class="dv">1</span><span class="sc">:</span><span class="dv">950</span>]<span class="sc">&lt;</span>alpha)<span class="sc">/</span><span class="fu">sum</span>(p_BH[<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>]<span class="sc">&lt;</span>alpha)</span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a>  count_Bf[<span class="dv">2</span>]<span class="ot">&lt;-</span>error_rate_Bf<span class="sc">+</span>count_Bf[<span class="dv">2</span>]</span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a>  count_BH[<span class="dv">2</span>]<span class="ot">&lt;-</span>error_rate_BH<span class="sc">+</span>count_BH[<span class="dv">2</span>]</span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a>  </span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a>  </span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a>  </span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a>  <span class="co">#计算TPR</span></span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a>  </span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a>  count_Bf[<span class="dv">3</span>]<span class="ot">&lt;-</span><span class="fu">sum</span>(p_Bf[<span class="dv">951</span><span class="sc">:</span><span class="dv">1000</span>]<span class="sc">&lt;</span>alpha)<span class="sc">/</span><span class="dv">50</span><span class="sc">+</span>count_Bf[<span class="dv">3</span>]</span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a>  count_BH[<span class="dv">3</span>]<span class="ot">&lt;-</span><span class="fu">sum</span>(p_BH[<span class="dv">951</span><span class="sc">:</span><span class="dv">1000</span>]<span class="sc">&lt;</span>alpha)<span class="sc">/</span><span class="dv">50</span><span class="sc">+</span>count_BH[<span class="dv">3</span>]</span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a>  </span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a>  }</span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a></span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;两种方法的FWER,FER,TPR依次为:&quot;</span>)</span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a><span class="do">## [1] &quot;两种方法的FWER,FER,TPR依次为:&quot;</span></span>
<span id="cb9-54"><a href="#cb9-54" tabindex="-1"></a><span class="fu">print</span>(count_Bf<span class="sc">/</span>m)</span>
<span id="cb9-55"><a href="#cb9-55" tabindex="-1"></a><span class="do">## [1] 0.072000000 0.003815318 0.393900000</span></span>
<span id="cb9-56"><a href="#cb9-56" tabindex="-1"></a><span class="fu">print</span>(count_BH<span class="sc">/</span>m)</span>
<span id="cb9-57"><a href="#cb9-57" tabindex="-1"></a><span class="do">## [1] 0.92600000 0.09204139 0.55878000</span></span></code></pre></div>
</div>
<div id="qusetion-2" class="section level2">
<h2>Qusetion 2</h2>
<p>利用bootstrap方法，估计指数分布的均值与方差，我们假设<span class="math inline">\(\lambda=\frac{1}{\bar{X}}\)</span>，<span class="math inline">\(\lambda=2\)</span>。对比bootstrap方法计算出的均值和方差与理论上的均值与方差。</p>
</div>
<div id="answer-2-2" class="section level2">
<h2>Answer 2</h2>
<p>按照bootstrap的步骤，重复<span class="math inline">\(M=1000\)</span>次。每个样本集做bootstrap次数为1000</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>num_bootstrap_samples <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="dv">1000</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="cf">for</span> (id <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">20</span>)) {</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  </span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> id</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co"># 生成原始指数分布的数据</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co"># 定义函数执行Bootstrap抽样并计算统计量</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>bootstrap_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(data, num_samples) </span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>{</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>  bootstrap_means <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_samples)</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_samples) {</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>    resampled_data <span class="ot">&lt;-</span> <span class="fu">sample</span>(data, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>    bootstrap_means[s] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">mean</span>(resampled_data)</span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>  }</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(bootstrap_means))</span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>}</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>bootstrap_var <span class="ot">&lt;-</span> <span class="cf">function</span>(data, num_samples) {</span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a>  bootstrap_means <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_samples)</span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_samples) {</span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a>    resampled_data <span class="ot">&lt;-</span> <span class="fu">sample</span>(data, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>bootstrap_means[s] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">mean</span>(resampled_data)</span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a>  }</span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a>  bootstrap_means<span class="ot">&lt;-</span>bootstrap_means<span class="sc">-</span>lambda</span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">var</span>(bootstrap_means))</span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a>}</span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a></span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a><span class="co"># 执行Bootstrap抽样</span></span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a>bootstrap_bias<span class="ot">&lt;-</span><span class="fu">numeric</span>(M)</span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a>bootstrap_vars<span class="ot">&lt;-</span><span class="fu">numeric</span>(M)</span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M) {</span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a>  </span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a>  original_data <span class="ot">&lt;-</span> <span class="fu">rexp</span>(sample_size, <span class="at">rate =</span> lambda)</span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a>  </span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a>bootstrap_bias[i] <span class="ot">&lt;-</span> <span class="fu">bootstrap_mean</span>(original_data, num_bootstrap_samples)<span class="sc">-</span>lambda</span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a>bootstrap_vars[i] <span class="ot">&lt;-</span> <span class="fu">bootstrap_var</span>(original_data, num_bootstrap_samples)</span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a>}</span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a><span class="co"># 打印结果</span></span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;样本大小:&quot;</span>,sample_size,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-49"><a href="#cb10-49" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Bootstrap bias:&quot;</span>,<span class="fu">mean</span>(bootstrap_bias) , <span class="st">&quot;bias真值&quot;</span>, <span class="dv">2</span><span class="sc">/</span>(sample_size<span class="dv">-1</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-50"><a href="#cb10-50" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Bootstrap方差:&quot;</span>, <span class="fu">mean</span>(bootstrap_vars), <span class="st">&quot;真实方差&quot;</span>,lambda<span class="sc">*</span>sample_size<span class="sc">/</span>(sample_size<span class="sc">*</span><span class="fu">sqrt</span>(sample_size<span class="dv">-2</span>)), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-51"><a href="#cb10-51" tabindex="-1"></a></span>
<span id="cb10-52"><a href="#cb10-52" tabindex="-1"></a>}</span>
<span id="cb10-53"><a href="#cb10-53" tabindex="-1"></a><span class="do">## 样本大小: 5 </span></span>
<span id="cb10-54"><a href="#cb10-54" tabindex="-1"></a><span class="do">## Bootstrap bias: 1.06087 bias真值 0.5 </span></span>
<span id="cb10-55"><a href="#cb10-55" tabindex="-1"></a><span class="do">## Bootstrap方差: 437.7952 真实方差 1.154701 </span></span>
<span id="cb10-56"><a href="#cb10-56" tabindex="-1"></a><span class="do">## 样本大小: 10 </span></span>
<span id="cb10-57"><a href="#cb10-57" tabindex="-1"></a><span class="do">## Bootstrap bias: 0.4065225 bias真值 0.2222222 </span></span>
<span id="cb10-58"><a href="#cb10-58" tabindex="-1"></a><span class="do">## Bootstrap方差: 0.8563957 真实方差 0.7071068 </span></span>
<span id="cb10-59"><a href="#cb10-59" tabindex="-1"></a><span class="do">## 样本大小: 20 </span></span>
<span id="cb10-60"><a href="#cb10-60" tabindex="-1"></a><span class="do">## Bootstrap bias: 0.2067766 bias真值 0.1052632 </span></span>
<span id="cb10-61"><a href="#cb10-61" tabindex="-1"></a><span class="do">## Bootstrap方差: 0.2824325 真实方差 0.4714045</span></span></code></pre></div>
<p>可以看出，当sample_size越来越大时，boorstrap结果与真实值更为接近。</p>
</div>
<div id="qusetion-3" class="section level2">
<h2>Qusetion 3</h2>
<p>获取correlation统计量的 bootstrap
t-置信区间估计,使用bootstrap包中的law 数据集。</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;bootstrap&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>law<span class="ot">&lt;-</span>law82[<span class="fu">c</span>(<span class="st">&quot;LSAT&quot;</span>,<span class="st">&quot;GPA&quot;</span>)]</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>M<span class="ot">&lt;-</span><span class="dv">1000</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>C<span class="ot">&lt;-</span><span class="fu">numeric</span>(M)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>{</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>  sample_data<span class="ot">&lt;-</span><span class="fu">sample</span>(law,<span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a> </span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>  C[i]<span class="ot">&lt;-</span> <span class="fu">cor</span>(sample_data[,<span class="dv">1</span>],sample_data[,<span class="dv">2</span>])</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>}</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">mean</span>(C))</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="do">## [1] 0.8799989</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;置信区间为:(&quot;</span>,<span class="fu">mean</span>(C)<span class="sc">-</span><span class="fl">1.96</span><span class="sc">*</span><span class="fu">sd</span>(C),<span class="st">&quot;,&quot;</span>,<span class="fu">mean</span>(C)<span class="sc">+</span><span class="fl">1.96</span><span class="sc">*</span><span class="fu">sd</span>(C),<span class="st">&quot;)&quot;</span>)</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="do">## 置信区间为:( 0.6446791 , 1.115319 )</span></span></code></pre></div>
</div>
</div>
<div id="homework6" class="section level1">
<h1>Homework6</h1>
<div id="question-1-4" class="section level2">
<h2>Question 1</h2>
<p>计算平均故障间隔时间 <span class="math inline">\(1/\lambda\)</span>的
95% bootstrap 置信区间，分别利用 标准正态、basic、百分位、 和 BCa 方法。
比较置信区间并解释它们可能不同的原因。</p>
</div>
<div id="answer-1-3" class="section level2">
<h2>Answer 1</h2>
<p>前三种方法直接按照置信区间的定义就可以求解<span class="math inline">\(95\%\)</span>置信区间，针对BCa方法，我们需要调用例题中出现的BCa.boot()函数，以方便我们的计算:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># 原始数据</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">18</span>,<span class="dv">43</span>,<span class="dv">85</span>,<span class="dv">91</span>,<span class="dv">98</span>,<span class="dv">100</span>,<span class="dv">130</span>,<span class="dv">230</span>,<span class="dv">487</span>)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co"># 设置Bootstrap参数</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(data)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>num_bootstrap_samples <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span>  <span class="co"># 95% confidence interval</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co"># 初始化变量来存储Bootstrap样本均值</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>bootstrap_sample_means <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_bootstrap_samples)</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co"># 执行Bootstrap抽样</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_bootstrap_samples) {</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>  resampled_data <span class="ot">&lt;-</span> <span class="fu">sample</span>(data, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>  bootstrap_sample_means[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(resampled_data)</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>}</span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co"># Standard Normal Method</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sd</span>(bootstrap_sample_means)  <span class="co"># Standard error of sample means</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>z_alpha_over_2 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>)  <span class="co"># Z quantile</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>standard_normal_lower <span class="ot">&lt;-</span> <span class="fu">mean</span>(bootstrap_sample_means) <span class="sc">-</span> z_alpha_over_2 <span class="sc">*</span> se</span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a>standard_normal_upper <span class="ot">&lt;-</span> <span class="fu">mean</span>(bootstrap_sample_means) <span class="sc">+</span> z_alpha_over_2 <span class="sc">*</span> se</span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a><span class="co"># Basic Bootstrap Method</span></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a>bias <span class="ot">&lt;-</span> <span class="fu">mean</span>(bootstrap_sample_means) <span class="sc">-</span> <span class="fu">mean</span>(data)</span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a>bias_corrected_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(bootstrap_sample_means) <span class="sc">-</span> bias</span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a>basic_bootstrap_se <span class="ot">&lt;-</span> <span class="fu">sd</span>(bootstrap_sample_means <span class="sc">-</span> bias)  <span class="co"># Bias-corrected SE</span></span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a>basic_lower <span class="ot">&lt;-</span> bias_corrected_mean <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> basic_bootstrap_se</span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a>basic_upper <span class="ot">&lt;-</span> bias_corrected_mean <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> basic_bootstrap_se</span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a><span class="co"># Percentile Method</span></span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a>percentile_lower <span class="ot">&lt;-</span> <span class="fu">quantile</span>(bootstrap_sample_means, alpha <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a>percentile_upper <span class="ot">&lt;-</span> <span class="fu">quantile</span>(bootstrap_sample_means, <span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a><span class="co"># BCa (Bias-Corrected and Accelerated) Method</span></span>
<span id="cb12-43"><a href="#cb12-43" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb12-45"><a href="#cb12-45" tabindex="-1"></a>theta.b <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_bootstrap_samples)</span>
<span id="cb12-46"><a href="#cb12-46" tabindex="-1"></a>  theta.hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(data)</span>
<span id="cb12-47"><a href="#cb12-47" tabindex="-1"></a>  <span class="co">#bootstrap</span></span>
<span id="cb12-48"><a href="#cb12-48" tabindex="-1"></a>  <span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_bootstrap_samples) {</span>
<span id="cb12-49"><a href="#cb12-49" tabindex="-1"></a>    i <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-50"><a href="#cb12-50" tabindex="-1"></a>    theta.b[b] <span class="ot">&lt;-</span> <span class="fu">mean</span>(data[i])</span>
<span id="cb12-51"><a href="#cb12-51" tabindex="-1"></a>  }</span>
<span id="cb12-52"><a href="#cb12-52" tabindex="-1"></a>  </span>
<span id="cb12-53"><a href="#cb12-53" tabindex="-1"></a>  stat <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, index) {</span>
<span id="cb12-54"><a href="#cb12-54" tabindex="-1"></a>    <span class="fu">mean</span>(dat[index]) }</span>
<span id="cb12-55"><a href="#cb12-55" tabindex="-1"></a>  </span>
<span id="cb12-56"><a href="#cb12-56" tabindex="-1"></a>  boot.BCa <span class="ot">&lt;-</span></span>
<span id="cb12-57"><a href="#cb12-57" tabindex="-1"></a>    <span class="cf">function</span>(x, th0, th, stat, <span class="at">conf =</span> .<span class="dv">95</span>) {</span>
<span id="cb12-58"><a href="#cb12-58" tabindex="-1"></a>   </span>
<span id="cb12-59"><a href="#cb12-59" tabindex="-1"></a>      x <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(x)</span>
<span id="cb12-60"><a href="#cb12-60" tabindex="-1"></a>      n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x) <span class="co">#observations in rows</span></span>
<span id="cb12-61"><a href="#cb12-61" tabindex="-1"></a>      N <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n</span>
<span id="cb12-62"><a href="#cb12-62" tabindex="-1"></a>      alpha <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span>conf, conf))<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb12-63"><a href="#cb12-63" tabindex="-1"></a>      zalpha <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(alpha)</span>
<span id="cb12-64"><a href="#cb12-64" tabindex="-1"></a>      <span class="co"># the bias correction factor</span></span>
<span id="cb12-65"><a href="#cb12-65" tabindex="-1"></a>      z0 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fu">sum</span>(th <span class="sc">&lt;</span> th0) <span class="sc">/</span> <span class="fu">length</span>(th))</span>
<span id="cb12-66"><a href="#cb12-66" tabindex="-1"></a>      <span class="co"># the acceleration factor (jackknife est.)</span></span>
<span id="cb12-67"><a href="#cb12-67" tabindex="-1"></a>      th.jack <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb12-68"><a href="#cb12-68" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb12-69"><a href="#cb12-69" tabindex="-1"></a>        J <span class="ot">&lt;-</span> N[<span class="dv">1</span><span class="sc">:</span>(n<span class="dv">-1</span>)]</span>
<span id="cb12-70"><a href="#cb12-70" tabindex="-1"></a>        th.jack[i] <span class="ot">&lt;-</span> <span class="fu">stat</span>(x[<span class="sc">-</span>i, ], J)</span>
<span id="cb12-71"><a href="#cb12-71" tabindex="-1"></a>      }</span>
<span id="cb12-72"><a href="#cb12-72" tabindex="-1"></a>      L <span class="ot">&lt;-</span> <span class="fu">mean</span>(th.jack) <span class="sc">-</span> th.jack</span>
<span id="cb12-73"><a href="#cb12-73" tabindex="-1"></a>      a <span class="ot">&lt;-</span> <span class="fu">sum</span>(L<span class="sc">^</span><span class="dv">3</span>)<span class="sc">/</span>(<span class="dv">6</span> <span class="sc">*</span> <span class="fu">sum</span>(L<span class="sc">^</span><span class="dv">2</span>)<span class="sc">^</span><span class="fl">1.5</span>)</span>
<span id="cb12-74"><a href="#cb12-74" tabindex="-1"></a>      <span class="co"># BCa conf. limits</span></span>
<span id="cb12-75"><a href="#cb12-75" tabindex="-1"></a>      adj.alpha <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(z0 <span class="sc">+</span> (z0<span class="sc">+</span>zalpha)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>a<span class="sc">*</span>(z0<span class="sc">+</span>zalpha)))</span>
<span id="cb12-76"><a href="#cb12-76" tabindex="-1"></a>      limits <span class="ot">&lt;-</span> <span class="fu">quantile</span>(th, adj.alpha, <span class="at">type=</span><span class="dv">6</span>)</span>
<span id="cb12-77"><a href="#cb12-77" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;est&quot;</span><span class="ot">=</span>th0, <span class="st">&quot;BCa&quot;</span><span class="ot">=</span>limits))</span>
<span id="cb12-78"><a href="#cb12-78" tabindex="-1"></a>    }</span>
<span id="cb12-79"><a href="#cb12-79" tabindex="-1"></a>  </span>
<span id="cb12-80"><a href="#cb12-80" tabindex="-1"></a>  op<span class="ot">&lt;-</span><span class="fu">boot.BCa</span>(data, <span class="at">th0 =</span> theta.hat, <span class="at">th =</span> theta.b, <span class="at">stat =</span> stat)</span>
<span id="cb12-81"><a href="#cb12-81" tabindex="-1"></a>  </span>
<span id="cb12-82"><a href="#cb12-82" tabindex="-1"></a>  bca_lower<span class="ot">&lt;-</span>op<span class="sc">$</span>BCa[<span class="dv">1</span>]</span>
<span id="cb12-83"><a href="#cb12-83" tabindex="-1"></a>  bca_upper<span class="ot">&lt;-</span>op<span class="sc">$</span>BCa[<span class="dv">2</span>]</span>
<span id="cb12-84"><a href="#cb12-84" tabindex="-1"></a>  </span>
<span id="cb12-85"><a href="#cb12-85" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Standard Normal Method CI: [&quot;</span>, standard_normal_lower, <span class="st">&quot;, &quot;</span>, standard_normal_upper, <span class="st">&quot;]</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb12-86"><a href="#cb12-86" tabindex="-1"></a><span class="do">## Standard Normal Method CI: [ 34.27047 ,  185.5615 ]</span></span>
<span id="cb12-87"><a href="#cb12-87" tabindex="-1"></a>  </span>
<span id="cb12-88"><a href="#cb12-88" tabindex="-1"></a>  </span>
<span id="cb12-89"><a href="#cb12-89" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Basic Bootstrap Method CI: [&quot;</span>, basic_lower, <span class="st">&quot;, &quot;</span>, basic_upper, <span class="st">&quot;]</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb12-90"><a href="#cb12-90" tabindex="-1"></a><span class="do">## Basic Bootstrap Method CI: [ 32.4378 ,  183.7289 ]</span></span>
<span id="cb12-91"><a href="#cb12-91" tabindex="-1"></a></span>
<span id="cb12-92"><a href="#cb12-92" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Percentile Method CI: [&quot;</span>, percentile_lower, <span class="st">&quot;, &quot;</span>, percentile_upper, <span class="st">&quot;]</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb12-93"><a href="#cb12-93" tabindex="-1"></a><span class="do">## Percentile Method CI: [ 45.575 ,  194.1687 ]</span></span>
<span id="cb12-94"><a href="#cb12-94" tabindex="-1"></a></span>
<span id="cb12-95"><a href="#cb12-95" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;BCa Method CI: [&quot;</span>, bca_lower, <span class="st">&quot;, &quot;</span>, bca_upper, <span class="st">&quot;]</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb12-96"><a href="#cb12-96" tabindex="-1"></a><span class="do">## BCa Method CI: [ 58.35666 ,  221.0252 ]</span></span></code></pre></div>
<p>标准正态法通常假设Bootstrap样本均值近似正态分布，basic法假设Bootstrap样本均值是原始数据均值的无偏估计，百分位法使用百分位数估计置信区间，而BCa方法考虑了偏差和加速度修正以更准确地估计置信区间。可以看到置信区间的宽度是逐渐下降的，我们认为是因为这四种方法中标准正态法假设最强，因此宽度最窄，而依赖分位数的方法假设较弱，置信区间较宽，更为稳健。</p>
</div>
<div id="qusetion-2-1" class="section level2">
<h2>Qusetion 2</h2>
<p>利用jackknife算法,计算最大的特征值所占的比例<span class="math inline">\(\theta=\frac{\lambda_1}{\sum_i^5
\lambda_i}\)</span>的bias和variance。其中<span class="math inline">\(\lambda_i\)</span>的估计值来源于对<span class="math inline">\(\Sigma\)</span>矩阵特征值的估计</p>
</div>
<div id="answer-2-3" class="section level2">
<h2>Answer 2</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a> <span class="fu">library</span>(bootstrap)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="fu">data</span>(scor)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>data<span class="ot">&lt;-</span>scor</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>cov_matrix <span class="ot">&lt;-</span> <span class="fu">cov</span>(data)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>eigen_result <span class="ot">&lt;-</span> <span class="fu">eigen</span>(cov_matrix)</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>eigenvalues <span class="ot">&lt;-</span> eigen_result<span class="sc">$</span>values</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">max</span>(eigenvalues) <span class="sc">/</span> <span class="fu">sum</span>(eigenvalues)</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co"># 创建一个函数</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>jackknife_estimate <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(data)</span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>  theta_estimates <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>  </span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a> </span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>    pseudo_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>i]</span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>    pseudo_theta <span class="ot">&lt;-</span> <span class="fu">min</span>(pseudo_data) <span class="sc">/</span> <span class="fu">sum</span>(pseudo_data)</span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a>    </span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a>    theta_estimates[i] <span class="ot">&lt;-</span> pseudo_theta</span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a>  }</span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a>  </span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a> </span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a>  bias <span class="ot">&lt;-</span> (n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">mean</span>(theta_estimates) <span class="sc">-</span> theta</span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a>  </span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a>  </span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a>  se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(((n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> n) <span class="sc">*</span> <span class="fu">sum</span>((theta_estimates <span class="sc">-</span> <span class="fu">mean</span>(theta_estimates))<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a>  </span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">bias =</span> bias, <span class="at">se =</span> se))</span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a>}</span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a></span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" tabindex="-1"></a>jackknife_result <span class="ot">&lt;-</span> <span class="fu">jackknife_estimate</span>(eigenvalues)</span>
<span id="cb13-40"><a href="#cb13-40" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" tabindex="-1"></a><span class="co"># 输出Jackknife估计的偏差和标准误差</span></span>
<span id="cb13-42"><a href="#cb13-42" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Jackknife Estimate of Bias:&quot;</span>, jackknife_result<span class="sc">$</span>bias, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-43"><a href="#cb13-43" tabindex="-1"></a><span class="do">## Jackknife Estimate of Bias: -0.4164064</span></span>
<span id="cb13-44"><a href="#cb13-44" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Jackknife Estimate of Standard Error:&quot;</span>, jackknife_result<span class="sc">$</span>se, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-45"><a href="#cb13-45" tabindex="-1"></a><span class="do">## Jackknife Estimate of Standard Error: 0.04360899</span></span></code></pre></div>
</div>
<div id="question-3-1" class="section level2">
<h2>Question 3</h2>
<p>在示例 7.18 中，使用留一（n 重）交叉验证来选择 最佳拟合模型。
使用留二法交叉验证来比较模型</p>
</div>
<div id="answer-3-1" class="section level2">
<h2>Answer 3</h2>
<p>按照例7.18的步骤，我们依次建立四类模型，在抽取数据的时候每轮循环排除两个数据点，其余步骤类似。</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">library</span>(DAAG)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>calculate_prediction_error1 <span class="ot">&lt;-</span> <span class="cf">function</span>(model, data) {</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  predicted_values <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> data)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  actual_values <span class="ot">&lt;-</span> data<span class="sc">$</span>magnetic</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>  error <span class="ot">&lt;-</span> <span class="fu">mean</span>((predicted_values <span class="sc">-</span> actual_values)<span class="sc">^</span><span class="dv">2</span>)  </span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>  <span class="fu">return</span>(error)</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>}</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>calculate_prediction_error2 <span class="ot">&lt;-</span> <span class="cf">function</span>(model, data) {</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>  predicted_values <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> data)</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>  actual_values <span class="ot">&lt;-</span> data<span class="sc">$</span>magnetic</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>  error <span class="ot">&lt;-</span> <span class="fu">mean</span>((<span class="fu">exp</span>(predicted_values) <span class="sc">-</span> actual_values)<span class="sc">^</span><span class="dv">2</span>)  <span class="co"># Mean Squared Error</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>  <span class="fu">return</span>(error)</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>}</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="fu">data</span>(ironslag)</span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>data<span class="ot">&lt;-</span>ironslag</span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a><span class="co"># Define the proposed models</span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>model_linear <span class="ot">&lt;-</span> <span class="fu">lm</span>(magnetic <span class="sc">~</span> chemical, <span class="at">data =</span> data)</span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>model_quadratic <span class="ot">&lt;-</span> <span class="fu">lm</span>(magnetic <span class="sc">~</span> chemical <span class="sc">+</span> <span class="fu">I</span>(chemical<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> data)</span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a>model_exponential <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(magnetic) <span class="sc">~</span> chemical, <span class="at">data =</span> data)</span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a>model_log_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(magnetic) <span class="sc">~</span> <span class="fu">log</span>(chemical), <span class="at">data =</span> data)</span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a><span class="co"># Set the number </span></span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a>num_iterations <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data) <span class="sc">*</span> (<span class="fu">nrow</span>(data) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a>errors_linear <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_iterations)</span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a>errors_quadratic <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_iterations)</span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a>errors_exponential <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_iterations)</span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a>errors_log_log <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_iterations)</span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  </span>
<span id="cb14-37"><a href="#cb14-37" tabindex="-1"></a>iteration <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb14-38"><a href="#cb14-38" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(data) <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb14-39"><a href="#cb14-39" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> (i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data)) {</span>
<span id="cb14-40"><a href="#cb14-40" tabindex="-1"></a>    validation_data <span class="ot">&lt;-</span> data[<span class="fu">c</span>(i, j), ]</span>
<span id="cb14-41"><a href="#cb14-41" tabindex="-1"></a>    training_data <span class="ot">&lt;-</span> data[<span class="sc">-</span><span class="fu">c</span>(i, j), ]</span>
<span id="cb14-42"><a href="#cb14-42" tabindex="-1"></a>    </span>
<span id="cb14-43"><a href="#cb14-43" tabindex="-1"></a>    <span class="co"># Calculate prediction errors for each model</span></span>
<span id="cb14-44"><a href="#cb14-44" tabindex="-1"></a>    errors_linear[iteration] <span class="ot">&lt;-</span> <span class="fu">calculate_prediction_error1</span>(model_linear, validation_data)</span>
<span id="cb14-45"><a href="#cb14-45" tabindex="-1"></a>    errors_quadratic[iteration] <span class="ot">&lt;-</span> <span class="fu">calculate_prediction_error1</span>(model_quadratic, validation_data)</span>
<span id="cb14-46"><a href="#cb14-46" tabindex="-1"></a>    errors_exponential[iteration] <span class="ot">&lt;-</span> <span class="fu">calculate_prediction_error2</span>(model_exponential, validation_data)</span>
<span id="cb14-47"><a href="#cb14-47" tabindex="-1"></a>    errors_log_log[iteration] <span class="ot">&lt;-</span> <span class="fu">calculate_prediction_error2</span>(model_log_log, validation_data)</span>
<span id="cb14-48"><a href="#cb14-48" tabindex="-1"></a>    </span>
<span id="cb14-49"><a href="#cb14-49" tabindex="-1"></a>    iteration <span class="ot">&lt;-</span> iteration <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb14-50"><a href="#cb14-50" tabindex="-1"></a>  }</span>
<span id="cb14-51"><a href="#cb14-51" tabindex="-1"></a>}</span>
<span id="cb14-52"><a href="#cb14-52" tabindex="-1"></a></span>
<span id="cb14-53"><a href="#cb14-53" tabindex="-1"></a><span class="co"># Calculate mean prediction errors for each model</span></span>
<span id="cb14-54"><a href="#cb14-54" tabindex="-1"></a>mean_error_linear <span class="ot">&lt;-</span> <span class="fu">mean</span>(errors_linear)</span>
<span id="cb14-55"><a href="#cb14-55" tabindex="-1"></a>mean_error_quadratic <span class="ot">&lt;-</span> <span class="fu">mean</span>(errors_quadratic)</span>
<span id="cb14-56"><a href="#cb14-56" tabindex="-1"></a>mean_error_exponential <span class="ot">&lt;-</span> <span class="fu">mean</span>(errors_exponential)</span>
<span id="cb14-57"><a href="#cb14-57" tabindex="-1"></a>mean_error_log_log <span class="ot">&lt;-</span> <span class="fu">mean</span>(errors_log_log)</span>
<span id="cb14-58"><a href="#cb14-58" tabindex="-1"></a></span>
<span id="cb14-59"><a href="#cb14-59" tabindex="-1"></a></span>
<span id="cb14-60"><a href="#cb14-60" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean Prediction Errors (Leave-Two-Out Cross-Validation):</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb14-61"><a href="#cb14-61" tabindex="-1"></a><span class="do">## Mean Prediction Errors (Leave-Two-Out Cross-Validation):</span></span>
<span id="cb14-62"><a href="#cb14-62" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Linear Model:&quot;</span>, mean_error_linear, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb14-63"><a href="#cb14-63" tabindex="-1"></a><span class="do">## Linear Model: 18.02025</span></span>
<span id="cb14-64"><a href="#cb14-64" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Quadratic Model:&quot;</span>, mean_error_quadratic, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb14-65"><a href="#cb14-65" tabindex="-1"></a><span class="do">## Quadratic Model: 15.84495</span></span>
<span id="cb14-66"><a href="#cb14-66" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Exponential Model:&quot;</span>, mean_error_exponential, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb14-67"><a href="#cb14-67" tabindex="-1"></a><span class="do">## Exponential Model: 17.10349</span></span>
<span id="cb14-68"><a href="#cb14-68" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Log-Log Model:&quot;</span>, mean_error_log_log, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb14-69"><a href="#cb14-69" tabindex="-1"></a><span class="do">## Log-Log Model: 18.9952</span></span></code></pre></div>
<p>经过留2验证法比较MSE，我们可以得出最优模型应当是二次模型（ Quadratic
Model ）。</p>
<p>#Homework 7</p>
</div>
<div id="question-1-5" class="section level2">
<h2>Question 1</h2>
<p>证明连续情况下，给定采样概率<span class="math inline">\(\alpha(s,
r)=\min \left\{\frac{f(r) g(s \mid r)}{f(s) g(r \mid s)},
1\right\}\)</span>的马尔可夫链满足平稳性条件。</p>
</div>
<div id="answer-1-4" class="section level2">
<h2>Answer 1</h2>
<p>在连续性条件下转移核为： <span class="math display">\[
K(r, s)=\alpha(r, s) g(s \mid r)+I(s=r)\left[1-\int \alpha(r, s) g(s
\mid r)\right] \text {. }
\]</span> 由于<span class="math inline">\(f(s),g(s)\)</span>均是连续性随机变量的密度函数。因此示性函数<span class="math inline">\(I(s=r)=1\)</span>的概率测度为0.所以<span class="math inline">\(K(s,r)=\alpha(r,s)g(s|r)\)</span></p>
<p>那么我们只需验证 <span class="math inline">\(K(s, r) f(s)=K(r, s)
f(r)\)</span>这一等式成立即可。这与离散情形下的证明一致，带入计算即可。</p>
</div>
<div id="qusstion-2" class="section level2">
<h2>Qusstion 2</h2>
<p>实施等分布的双样本 Cramer-von Mises 检验 。 利用例 8.1 和 8.2
中的数据。</p>
</div>
<div id="answer-2-4" class="section level2">
<h2>Answer 2</h2>
<p>在这里我们首先使用了 twosamples
包，它包含了执行两样本统计检验的函数。先使用 cvm_test 函数计算 x 和 y
的Cramér-von Mises统计量，存储在 cv_statistic_observed 变量中。</p>
<p>下一步通过迭代循环，进行了 num_permutations 次置换。
在每次迭代中，代码首先随机排列合并后的数据，然后将它们分割为两个与原始样本相同大小的样本，使用
cvm_test 函数计算Cramér-von Mises统计量，并将结果存储在
cv_statistics_permuted 中。最后比较出p值。</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">library</span>(twosamples)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">attach</span>(chickwts)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">as.vector</span>(weight[feed <span class="sc">==</span> <span class="st">&quot;soybean&quot;</span>]))</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">as.vector</span>(weight[feed <span class="sc">==</span> <span class="st">&quot;linseed&quot;</span>]))</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="fu">detach</span>(chickwts)</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>cv_statistic_observed <span class="ot">&lt;-</span> <span class="fu">cvm_test</span>(x,y)[<span class="dv">1</span>]</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>pooled_data <span class="ot">&lt;-</span> <span class="fu">c</span>( x, y)</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>num_permutations <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>cv_statistics_permuted <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_permutations)</span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  </span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_permutations) {</span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>  permuted_data <span class="ot">&lt;-</span> <span class="fu">sample</span>(pooled_data, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>  </span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a>  <span class="co"># Split the permuted data into two samples</span></span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a>  permuted_sample1 <span class="ot">&lt;-</span> permuted_data[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)]</span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a>  permuted_sample2 <span class="ot">&lt;-</span> permuted_data[(<span class="fu">length</span>(x) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(permuted_data)]</span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a>  </span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a>  <span class="co"># Calculate the Cramér-von Mises statistic for the permuted samples</span></span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a>  cv_statistics_permuted[i] <span class="ot">&lt;-</span> <span class="fu">cvm_test</span>(permuted_sample1, permuted_sample2)[<span class="dv">1</span>]</span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a>}</span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" tabindex="-1"></a>p_value <span class="ot">&lt;-</span> <span class="fu">sum</span>(cv_statistics_permuted <span class="sc">&gt;=</span> cv_statistic_observed) <span class="sc">/</span> num_permutations</span>
<span id="cb15-32"><a href="#cb15-32" tabindex="-1"></a></span>
<span id="cb15-33"><a href="#cb15-33" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb15-34"><a href="#cb15-34" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;原样本的 Cramér-von Mises 统计量:&quot;</span>, cv_statistic_observed, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb15-35"><a href="#cb15-35" tabindex="-1"></a><span class="do">## 原样本的 Cramér-von Mises 统计量: 0.6096939</span></span>
<span id="cb15-36"><a href="#cb15-36" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Permutation Test p-value:&quot;</span>, p_value, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb15-37"><a href="#cb15-37" tabindex="-1"></a><span class="do">## Permutation Test p-value: 0.44</span></span></code></pre></div>
<p>据此可知我们接受原假设.</p>
</div>
<div id="question-3-2" class="section level2">
<h2>Question 3</h2>
<p>第 6.4 节中的等方差”count 5 test”基于 极值点的数量。 例 6.15 表明计数
5 准则 不适用于不相等的样本量。 请开发一个permutation test
适用于最大极值点数量的等方差检验 当样本量不一定相等时</p>
</div>
<div id="answer-3-2" class="section level2">
<h2>Answer 3</h2>
<p>在permutation Test的步骤中： 1. 计算观察到的检验统计量 <span class="math inline">\(\hat{\theta}(X, Y)=\hat{\theta}(Z, \nu)\)</span>。
2. 对于每个重复，索引 <span class="math inline">\(b=1, \ldots,
B\)</span> ： (a) 生成随机排列 <span class="math inline">\(\pi_b=\pi(\nu)\)</span>。 (b) 计算统计量 <span class="math inline">\(\hat{\theta}^{(b)}=\hat{\theta}^*\left(Z,
\pi_b\right)\)</span>。 3. 如果 <span class="math inline">\(\hat{\theta}\)</span>
的较大值支持备择假设，则通过以下方式计算 经验 <span class="math inline">\(p\)</span> 值 <span class="math display">\[
\hat{p}=\frac{1+\#\left\{\hat{\theta}^{(b)} \geq
\hat{\theta}\right\}}{B+1}=\frac {\left\{1+\sum_{b=1}^B
I\left(\hat{\theta}^{(b)} \geq \hat{\theta}\right)\right\}}{B+ 1}
\]</span></p>
<p>在这个问题中，我们将估计量取为<span class="math inline">\(\theta(X,Y)=\{\text{number of extreme
point}\}\)</span></p>
<p>我们借用section6.5里面的max
out函数，用于计算x,y两个样本的极值点个数。</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>maxout <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  X <span class="ot">&lt;-</span> x <span class="sc">-</span> <span class="fu">mean</span>(x)</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> y <span class="sc">-</span> <span class="fu">mean</span>(y)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  outx <span class="ot">&lt;-</span> <span class="fu">sum</span>(X <span class="sc">&gt;</span> <span class="fu">max</span>(Y)) <span class="sc">+</span> <span class="fu">sum</span>(X <span class="sc">&lt;</span> <span class="fu">min</span>(Y))</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>  outy <span class="ot">&lt;-</span> <span class="fu">sum</span>(Y <span class="sc">&gt;</span> <span class="fu">max</span>(X)) <span class="sc">+</span> <span class="fu">sum</span>(Y <span class="sc">&lt;</span> <span class="fu">min</span>(X))</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">max</span>(<span class="fu">c</span>(outx, outy)))</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>}</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>mu1 <span class="ot">&lt;-</span> mu2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>sigma1 <span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>sigma2 <span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>p_list <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">100</span>)</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>{</span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>  </span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n1, mu1, sigma1)</span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n2, mu2, sigma2)</span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a>cv_statistic_observed<span class="ot">&lt;-</span><span class="fu">maxout</span>(x,y)</span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a></span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a>pooled_data <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y)</span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a>num_permutations <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb16-31"><a href="#cb16-31" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" tabindex="-1"></a>cv_statistics_permuted <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_permutations)</span>
<span id="cb16-33"><a href="#cb16-33" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_permutations) {</span>
<span id="cb16-36"><a href="#cb16-36" tabindex="-1"></a>  permuted_data <span class="ot">&lt;-</span> <span class="fu">sample</span>(pooled_data, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-37"><a href="#cb16-37" tabindex="-1"></a>  </span>
<span id="cb16-38"><a href="#cb16-38" tabindex="-1"></a>  <span class="co"># Split the permuted data into two samples</span></span>
<span id="cb16-39"><a href="#cb16-39" tabindex="-1"></a>  permuted_sample1 <span class="ot">&lt;-</span> permuted_data[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)]</span>
<span id="cb16-40"><a href="#cb16-40" tabindex="-1"></a>  permuted_sample2 <span class="ot">&lt;-</span> permuted_data[(<span class="fu">length</span>(x) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(permuted_data)]</span>
<span id="cb16-41"><a href="#cb16-41" tabindex="-1"></a>  </span>
<span id="cb16-42"><a href="#cb16-42" tabindex="-1"></a>  <span class="co"># Calculate the Cramér-von Mises statistic for the permuted samples</span></span>
<span id="cb16-43"><a href="#cb16-43" tabindex="-1"></a>  cv_statistics_permuted[i] <span class="ot">&lt;-</span> <span class="fu">maxout</span>(permuted_sample1,permuted_sample2)</span>
<span id="cb16-44"><a href="#cb16-44" tabindex="-1"></a>}</span>
<span id="cb16-45"><a href="#cb16-45" tabindex="-1"></a></span>
<span id="cb16-46"><a href="#cb16-46" tabindex="-1"></a>p_list[j]<span class="ot">=</span><span class="fu">sum</span>(cv_statistics_permuted <span class="sc">&gt;</span> cv_statistic_observed) <span class="sc">/</span> num_permutations</span>
<span id="cb16-47"><a href="#cb16-47" tabindex="-1"></a>}</span>
<span id="cb16-48"><a href="#cb16-48" tabindex="-1"></a><span class="fu">mean</span>(p_list)</span>
<span id="cb16-49"><a href="#cb16-49" tabindex="-1"></a><span class="do">## [1] 0.44076</span></span>
<span id="cb16-50"><a href="#cb16-50" tabindex="-1"></a></span>
<span id="cb16-51"><a href="#cb16-51" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;原样本的 Cramér-von Mises 统计量:&quot;</span>, cv_statistic_observed, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-52"><a href="#cb16-52" tabindex="-1"></a><span class="do">## 原样本的 Cramér-von Mises 统计量: 8</span></span>
<span id="cb16-53"><a href="#cb16-53" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Permutation Test p-value:&quot;</span>, p_value, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-54"><a href="#cb16-54" tabindex="-1"></a><span class="do">## Permutation Test p-value: 0.44</span></span></code></pre></div>
<p>在第一个实验里，我们令原假设成立，<span class="math inline">\(n1=20,n2 = 50,sigma1 =1,sigma2 =1\)</span></p>
</div>
</div>
<div id="homework-8" class="section level1">
<h1>Homework 8</h1>
<div id="question-1-6" class="section level2">
<h2>Question 1</h2>
<ol style="list-style-type: decimal">
<li>考虑一个模型 <span class="math inline">\(P\left(Y=1 \mid X_1, X_2,
X_3\right)=\frac{\exp \left(a+b_1 X_1+b_2 X_2+b_3 X_3\right)}{1+\ exp
\left(a+b_1 X_1+b_2 X_2+b_3 X_3\right)}\)</span>，其中 <span class="math inline">\(X_1 \sim P(1)、X_2 \sim
\operatorname{Exp}(1)\)</span> 和 <span class="math inline">\(X_3 \sim
B(1 ,0.5)\)</span>。</li>
</ol>
<ul>
<li>设计一个函数，将 <span class="math inline">\(N、b_1、b_2、b_3\)</span> 和 <span class="math inline">\(f_0\)</span> 作为输入值，并生成输出 <span class="math inline">\(a\)</span>。</li>
<li>调用此函数，输入值为<span class="math inline">\(N=10^6, b_1=0,
b_2=1, b_3=-1, f_0=0.1,0.01,0.001,0.0001\)</span>。</li>
<li>绘制 <span class="math inline">\(-\log f_0\)</span> 与 <span class="math inline">\(a\)</span> 的对比图。</li>
</ul>
</div>
<div id="qusetion-2-2" class="section level2">
<h2>Qusetion 2</h2>
<p>实现随机游走 Metropolis 采样器来生成标准拉普拉斯分布。
比较不同方差建议分布生成的链 。 另外，计算每条链的接受率</p>
</div>
<div id="answer2" class="section level2">
<h2>Answer2</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>laplace_pdf <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">abs</span>(x)))</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>}</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>metropolis_sampler <span class="ot">&lt;-</span> <span class="cf">function</span>(iterations, proposal_sd) {</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>  chain <span class="ot">&lt;-</span> <span class="fu">numeric</span>(iterations)</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>  acceptance_count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>  current_value <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)  </span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>  </span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iterations) {</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a> </span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>    proposal_value <span class="ot">&lt;-</span> current_value <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> proposal_sd)</span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>    </span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>    acceptance_ratio <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">1</span>, <span class="fu">laplace_pdf</span>(proposal_value) <span class="sc">/</span> <span class="fu">laplace_pdf</span>(current_value))</span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a> </span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> acceptance_ratio) {</span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a>      current_value <span class="ot">&lt;-</span> proposal_value</span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a>      acceptance_count <span class="ot">&lt;-</span> acceptance_count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a>    }</span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a>    </span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a>    chain[i] <span class="ot">&lt;-</span> current_value</span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a>  }</span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a>  </span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a>  <span class="co"># 计算接受率</span></span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a>  acceptance_rate <span class="ot">&lt;-</span> acceptance_count <span class="sc">/</span> iterations</span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a>  </span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">chain =</span> chain, <span class="at">acceptance_rate =</span> acceptance_rate))</span>
<span id="cb17-33"><a href="#cb17-33" tabindex="-1"></a>}</span>
<span id="cb17-34"><a href="#cb17-34" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" tabindex="-1"></a>iterations <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb17-37"><a href="#cb17-37" tabindex="-1"></a>proposal_sd_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>)  </span>
<span id="cb17-38"><a href="#cb17-38" tabindex="-1"></a></span>
<span id="cb17-39"><a href="#cb17-39" tabindex="-1"></a></span>
<span id="cb17-40"><a href="#cb17-40" tabindex="-1"></a></span>
<span id="cb17-41"><a href="#cb17-41" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb17-42"><a href="#cb17-42" tabindex="-1"></a></span>
<span id="cb17-43"><a href="#cb17-43" tabindex="-1"></a></span>
<span id="cb17-44"><a href="#cb17-44" tabindex="-1"></a><span class="cf">for</span> (proposal_sd <span class="cf">in</span> proposal_sd_values) {</span>
<span id="cb17-45"><a href="#cb17-45" tabindex="-1"></a> </span>
<span id="cb17-46"><a href="#cb17-46" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">metropolis_sampler</span>(iterations, proposal_sd)</span>
<span id="cb17-47"><a href="#cb17-47" tabindex="-1"></a>  </span>
<span id="cb17-48"><a href="#cb17-48" tabindex="-1"></a></span>
<span id="cb17-49"><a href="#cb17-49" tabindex="-1"></a>  <span class="fu">plot</span>(result<span class="sc">$</span>chain, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Iterations&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Chain Values&quot;</span>,</span>
<span id="cb17-50"><a href="#cb17-50" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb17-51"><a href="#cb17-51" tabindex="-1"></a>  </span>
<span id="cb17-52"><a href="#cb17-52" tabindex="-1"></a></span>
<span id="cb17-53"><a href="#cb17-53" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Proposal SD:&quot;</span>, proposal_sd, <span class="st">&quot;</span><span class="sc">\t</span><span class="st">Acceptance Rate:&quot;</span>, result<span class="sc">$</span>acceptance_rate, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb17-54"><a href="#cb17-54" tabindex="-1"></a>}</span>
<span id="cb17-55"><a href="#cb17-55" tabindex="-1"></a><span class="do">## Proposal SD: 0.1     Acceptance Rate: 0.9576</span></span>
<span id="cb17-56"><a href="#cb17-56" tabindex="-1"></a><span class="do">## Proposal SD: 1   Acceptance Rate: 0.6994</span></span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<pre><code>## Proposal SD: 10  Acceptance Rate: 0.1504</code></pre>
<p>在上述代码中，我们比较了三种不同的方差建议分布（0.1、1、10）。较小的方差导致样本接受率较高，但可能会有较长的收敛时间。较大的方差可能导致更快的移动，但接受率可能较低，浪费计算资源。因此在实际操作中，需要对建议分布的方差做取舍。</p>
</div>
<div id="qusetion-3-1" class="section level2">
<h2>Qusetion 3</h2>
<p>使用吉布斯采样器来生成二元正态链（Xt，Yt） ，<span class="math inline">\(X,Y\)</span>的均值为零、标准差为1，相关性为 0.9。
绘制 丢弃合适的启动样本后生成的样本。 适合简单的 对样本建立线性回归模型
Y = β0 + β1X 并检查残差 正态性和常数方差的模型。</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>gibbs_sampler <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">rho =</span> <span class="fl">0.9</span>) {</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a> </span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  </span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>  x[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>  y[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>  </span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>  </span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a> </span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>    x[t] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> rho <span class="sc">*</span> y[t <span class="sc">-</span> <span class="dv">1</span>], <span class="at">sd =</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> rho<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>    </span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a> </span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>    y[t] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> rho <span class="sc">*</span> x[t], <span class="at">sd =</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> rho<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a>  }</span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>  </span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>  <span class="co"># Return the bivariate normal chain</span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">X =</span> x, <span class="at">Y =</span> y))</span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a>}</span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a>chain <span class="ot">&lt;-</span> <span class="fu">gibbs_sampler</span>(n, <span class="at">rho =</span> <span class="fl">0.9</span>)</span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a><span class="fu">plot</span>(chain<span class="sc">$</span>X, chain<span class="sc">$</span>Y, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;X&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Bivariate Normal Chain&quot;</span>)</span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a></span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a></span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X, <span class="at">data =</span> chain)</span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a><span class="fu">abline</span>(lm_model, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(lm_model)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="fu">hist</span>(residuals, <span class="at">main =</span> <span class="st">&quot;Histogram of Residuals&quot;</span>, <span class="at">col =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(residuals), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="fu">qqnorm</span>(residuals, <span class="at">main =</span> <span class="st">&quot;Q-Q Plot of Residuals&quot;</span>)</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="fu">qqline</span>(residuals, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAz1BMVEUAAAAAADoAAGYAOjoAOmYAOpAAZpAAZrY6AAA6ADo6AGY6OgA6Ojo6OmY6OpA6ZpA6ZrY6kLY6kNtmAABmADpmOgBmOjpmZjpmkGZmkJBmkLZmkNtmtrZmtttmtv98OgCQOgCQZgCQZjqQkGaQkLaQtpCQttuQtv+Q2/+t2Oa2ZgC2Zjq2ZpC2kDq2kGa225C229u22/+2/7a2///bkDrbkGbbtmbbtpDb25Db27bb29vb/7bb/9vb////AAD/tmb/25D/27b//7b//9v///+9rxkPAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAO/UlEQVR4nO2dDXvbthHHodSatHltU6nptq7RtGbtbHrd5oVNmnWWbInf/zMNryRIArwjcZRo+f7P49ghqcPxx8M7CImC1SlxbgemLgYEiAEBYkCAGBAgBgSIAQFiQIAYECAGBIgBAWJAgBgQIAYEiAEBYkCAGBAgBgSIAQFiQIAYECAGBIgBAWJAgBgQIAYEiAEBYkCAGBAgBgSIAQFiQIDE/KH2/+M/3hOncLxbCvFa/7UVWrPP76MXy9O/f1tz6fjxm8bB3JgRyoy02biDyC30c6Oy2jD/9OYVNaC9cmbleyZ9u4l5pk9feZ4f3tjPVAdzz0wbUOQW+rnhAaqfyQQ5oLz0o/JMLGJXm9OVE95nyoMlIHkXbUCRW+jnhueQMv/ztaT55b0ybh1RYf3Ztzrl4518ejc6WZnID2/Eq/vio3qsn8sED2ux+HgtZm+Ln5fyqspuaSCrHpW7mcel/q0Mz17rNEoHjn+RH13aR21hzFTu8g/mBsHTWtp1NuvplYiGurG1p5bqIbgnIq0667l7QI737Lo6PH/YlxEqARld1x98ZSDgmTwmf9uPXr0vPAeO20JTd1EhP2IfvHfQAtJBYW020nOODHdDnTK3Pn9QUfBQfNBPyMSnYZvrIxLG4uGYOW7z++K/8oO/eVAXrbT5lfqseGuv1/IN1GLbe3SZCkVnxDmgAclT7iPqlLVZHbSAPq3lb2PTT8/LYgluqFP61uUf8uzVv0svlHWbRmaCSv19WFtAG3vhp39eqyxsnqv5V6fimylcvmxnfu3Oyt6s54ABVH3Es5l7gJplUNvhVDdKqyYN4UqcrAqwWgjXEzl+78o484TNv9XN+AaCni00TpdRPQcqQDr05790AnK1WC29ClCKG8bqwhTST6Ymnf3dcnBxLUNs4/72ASlLV3/7tI4C8g0EPLv6sbDVrr3LyoHjNn+tPHv13gD61VhyB2uAquK0ll4FKMWN0qph/PTu2pVliAgyJA5xQPFHJ5/LT6bwl1e77Oo5cNzKqukPtmSUv/63tVWBOegA1ZoBAyIIdqO0WtUXf60ycLwM0onoJ1IVbG1A8cxva5xFrfj1HDhuzWOsV/NF/WALUO8yCHbDL4Pk/X6l85ku8ZWZeC3mImj+8LSNl0FA9ZFpwJm+83XdgaMrfJ2/ZTvCO9gGFE4vwY1aLVbclblQZ8mudlBZBnUW0n4DJFy/mpLOpVo5YAHNvi0JPbmuRnWwDchPz95Cmhvmksx9+IPKebrrppvN97YF+mdjTx764r5Vi139mJuiNAjIM9D2TCUsr3/6XtYgX+oeVumA7qz+0W9Ku86qdzAAyEvP3UKSG7Yl/ZM8VeCUtTrNI+p490U7seDB8QUCyvQggYwORMfuEgUCcg2F6NDAhQvOYk/fLG2j7EWKh1wBMSBADAgQAwLEgAAxIEAMCBADAsSAADEgQAwIEAMCxIAAMSBADAgQAwLEgAAxIEAMCBADAsSAAE0X0GG90kvazjFb6Gm6gDK19m1RZGeesJwsoMN6U+yF/CFfl9xPkwaUqQUTDCiibHFYq4VmnMUiOph14udeMzEeoN1olntIRLRD3/dogHbTABQ5PBYgtSZLL8DbgJemA9LL07MVfGFbVahETo8EKNdLPxemEQcoGdB+dpOrQnoQIafg7cmD4wA6blfa78Kg6ra76/GUYompVNKq+ZAL45VBqmliG25g8y0ZkEpMAUprKEYA7fD3PfkIypI6Y0FAyrmRyyCNqttuKiBbBuWI+qDLjcAhCWcsQD1qsXRAZol34trRIKDxIqiHCACRuBE6NFoZ1EfTBVToHDY2ILDynS4gncNOHUHtluvuNgWQ945P53vq7rWa6DXhMmhXnK0MIgKEVO5eb9mLSK0ajCDVj34RgLzGRqxdFq7mx4sgfEifApBu2RvF2ttBQKqSH6mhiA9pBWh4d1V2UctiKF4GDYogG0DjdTWQDklAt6OPCJXN7B5lkGkmjgOoT0gnAzp8fdOZkvWoeuey25/qiKnEnn8EOUDUwx16rGOshmKPkE4ElFXtIOIBs1EB9QhpsgjCKRZnIUC6EptCO2j8QjruRnRM2gXQNAAljpjBXQ28P+WBKQESSSGUUcw5xwBNoquRBihxOqPpT3ngggAljbU2/SkP2Drs+QNCzMojBkUmC0ikl0F7eOD7uAXH7Zr/vxxAiM4qIswIAbV2GhokwghCCQqzCKBhA2Z5arveM7cTpwEEqQ3I9jMGZrFkRoSAXB6jbCiKVEAGUYJLhICy+UO+KB6XlDOrqYD2es70uB0+HU4HSDUU92p1B+XcfBIgFdLGmYQFFXVAKYRUQ/Hxd+/1z3CFAbVPICwc1gnT4K3eczogNTqnhjyIAbmxoAGAMEOcaHPpgPQQT7YizWKCAhDNECcBIPUSgtnfksAf+7/hgKiHOCkAUSgIqH0CY6HfECdk7gIB0TpEUYsh+mJof8x/vPH65w/IalidER6TTgCEm+pFm1MrlKiyWNr7YlONIEJAhMuAvSJoMoDSzRPOrCYCInlHlBxQ4vtifvp+DhsCiOQdUTpA4CRuH3/M32mAaN4Rpc9iaSIGhHxHtGOM5hkAap9AWoDfEcVPsxAAslvF38BvPXSJEhDiHVG76gWMIJEOyK72y+mWAddy2FjVvIqxPoAGL/DYV9/C0vHEei0DPgkgmRGl5+MDKgPZ+06o0FV9FnEmA0IuN5FPbXxA5cR8Pv8Q96ffMuBaETSokEbW74/Lz04HqLOrMSiC2ie65VXz2NpChhoAaHdLlcW6O6u9lgHX1yYOaweliwhQVUg//rZrHK/HMmCRCqjfJhDdiybTAVXVfNpjIwSEWW4St1IfoCIAVH7B4GADxjHfxdQsRjdgRgGon+BlwPUy+szjQacH1HSjNeTaCKCxACGb9mcH1PCnoAEEbyaCbdpfJiB4MxF0w+xkgPCd1UYRNKiaBzcTQTftTwWoR2c1HRBiM5ETRxCY5Xt0NQRdBHVtJoJt2pMAgrN8j85qswgaXgZ1N12RTXuahiKY5ftFUDIgus1Edh6gwYQw+wfhO6vNHHbehuJOlICGz62i9g9Cd1YnBUiQACLdP6hVRg/ui1F0DokAUe4f1CqC+gPKzJPKE9fatwGdd2aMDFA1QJW+cHu6gNonsBaQQ5w4c5cIyGuOpS83IQCE3T8I5U9BAggzi4A0N70IahdBDMjz52IB6XyW2O6YJKAdDSC75WdaQ6gGqH0CbYG0UNzdUgA6bs0zG7RVaWNMOh0QmegAEb5cE8hhpwZUe2I1QIMHPFwEEbztMwFANXM0gOxEJkVn9TIB0RSLPqD2CbQFOhFGEJk/DAjwJ5TDLgEQ2XvzFwoI9XI6auJwaoAEVSENV1+4icNQEXROQDtBFEHg2CZu2qc9Hm1P4DRZQMDiOyXcxGEwh10EoCVUSKMjaNqA0he6RoWaOAzmsAkBGjrxg1p1i5g4DBdBFwAo7S2fyp/TAsK0O4gAIQpphERsc9txAKHaHWRZrE9PNbrKNRJA4wDC1RpUEUSi0wJCtTt24uUCQkVQG1BiHhvSWRU1hb7qaKwyCG53tAANDSGaTd4iATRWLYZodwQADWpKEG3ydmJAsLldANCgEEJs8oZ5C3t6gG5bgGRvYwAizCZvmM1uI18mNjagaLsjBGhYEGE2ecNsdhsso882L7YTYQ0hhNnkDdzsVjfMzg9osopU8gzIScS+1vlcnVUyPS5Xem9ZxOKOrn6/iDXDztVZpZJuH6oCBtFQ7AQU+1r3c3U1imYz36pHKlp6Kane6gBeVApFULjawHpC3Fm1FkM/faQXlZo6HF7+0j20ZpNv/0JqhAiK/PSRfhRm6e1zAoTorBaEgEzxk9YXOzEg1M5rFIB0yaOXJ/bbECLuzokA9fAoDdB+dmM2c0r+CqQLBaSaQJLP4zL19aOLBUTtDgMC3GFAgDsTAnRhYkCAGBAgBgSIAQFiQIAYECAGBIgBAWJAgBgQIAYEiAEBIgXkrcTAzfmdQHmiI5SADutyfFS99L6fAiG1RiTJEUJA+2pK2szEpG0kQyJvgm2g6ADtxaqcw7IzNuNP4aM0EUCFN8lnVsmn7QlAp6TtLcYBZHL9JAohlfOpvtslWZMEhHz9NaaXkMWSnhQFoPJL2CdVSHtfDZ+yGn2cCJpMNW/QpITyOICm01BU2w8lvZtHD8i0OlJb+GRSX9Kc8roHd1YBMSBADAgQAwLEgAAxIEAMCBADAsSAADEgQAwIEAMCxIAAMSBADAgQAwLEgAAxIEAMCBADAsSAADEgQAwIEAMCxIAAMSBADAgQPaBqC5TQ6gXULsiNT7iN7v6D/ex+E07Hc02AaweskTEjiAaQklmQhf1s9Dp3wuyep/dwAo28SEB2ZVfnuioKQIev36mV0W4pl96E3gW3Wv7yTm3AsbFp2WUoev/IZd8lKQ7Qn5bCfiWSW9Nm/qh5oszPf3VeCL1VU5V44X3lpd5nr+XgdzJPb0ojSYD09iNqka2KVrerlklNLXAXHiC3nYv8u9x+qz8gaSC3P3aTM/VAFg1PVHo6YZPgyk+8slbo9UwBB00CzkgaoJW3DZJbXmZiRHmSVYD016mpo/LvAQviHKCVNlImaZaO6Z1ifE/cvblI8RMvCi/r74MOukQoAG1catqiuXF11DDY+1lMZwedpvdKR19AxliZpHkO9m58TzbeY7IsqtwfBFS/RntJBchWwhuzh6CxmrcAydLg1b/sQ7QXDgfkkjQE7N1UnpSAXFbyEy8iWax2DSmgWlVlc1UrgvSteFGuLhwOqP7F1PUIstf5EdRMvCqk5w9hBykB1etUa9muk7aFg/yfJravorxndV8HVH7WK4N8T5plUCtxFeDH7fwXXaCHHKQEZF4VkQGhH6BzVh1UtZh6C0DmqI15NmJVBkC/NcJ1QGWSXi3me6JuuvTiuF34iRt7mSYk9BLhtoMW0IoIkG5sGP66+V5rB+mOwncmi89uXAaE2/ndgMoky3ZQ3ZOs0Q7yEzfal1uuhhw09X56O+j56w5+TC8bEEIMCBADAsSAADEgQAwIEAMCxIAAMSBADAgQAwLEgAAxIEAMCBADAsSAADEgQAwIEAMCxIAAMSBADAgQAwL0f37wkSUh+tCNAAAAAElFTkSuQmCC" /><!-- --></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Intercept:&quot;</span>, <span class="fu">coef</span>(lm_model)[<span class="dv">1</span>], <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Intercept: 0.013328</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;beta:&quot;</span>, <span class="fu">coef</span>(lm_model)[<span class="dv">2</span>], <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## beta: 0.8657498</code></pre>
<p>在“Bivariate Normal Chain”图中，我们观察到了采样出的<span class="math inline">\((X,Y)\)</span>散点图近似分布呈一个椭圆形，这与相关系数<span class="math inline">\(\rho=0.9\)</span>的二元正态分布的密度函数类似，表明我们采样的结果良好。第二张图表明回归模型拟合良好，并且误差服从正态性分布，回归系数<span class="math inline">\(\beta\)</span>约等于0.9，也验证了题目所给的相关系数0.9的条件。</p>
</div>
<div id="question-4-1" class="section level2">
<h2>Question 4</h2>
<p>请参阅示例 9.1。 使用 Gelman-Rubin 方法监控收敛性
链，并运行该链，直到该链大约收敛到$ R^2 &lt;1.2$
的目标分布。也可以使用coda 包，用于Gelman-Rubin 方法检查链的收敛性。</p>
</div>
<div id="answer-4" class="section level2">
<h2>Answer 4</h2>
<p>在代码中，我们定义了metropolis_hastings_rayleigh函数实现了Metropolis-Hastings算法。它接受两个参数：n表示采样的数量，sigma_proposal表示建议分布的标准差。并且我们使用了coda包中的gelman.diag函数计算各个参数的Gelman-Rubin收敛诊断，使用gelman.plot函数生成Gelman-Rubin诊断图。</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="fu">library</span>(coda)</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>f_computed<span class="ot">&lt;-</span><span class="cf">function</span>(x,sigma1)</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>{</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>  <span class="fu">return</span>(  (x)<span class="sc">/</span>sigma1<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span><span class="fu">exp</span>(<span class="dv">1</span>)<span class="sc">^</span>{<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>sigma1<span class="sc">^</span><span class="dv">2</span>)} )</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>}</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>metropolis_hastings_rayleigh <span class="ot">&lt;-</span> <span class="cf">function</span>(n, sigma_proposal) </span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>  {</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>  x[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>    x_proposed <span class="ot">&lt;-</span> x[t <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, sigma_proposal)</span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a>    </span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a>    acceptance_ratio <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">1</span>, <span class="fu">f_computed</span>(x_proposed,<span class="dv">1</span>)<span class="sc">/</span><span class="fu">f_computed</span>(x[t <span class="sc">-</span> <span class="dv">1</span>],<span class="dv">1</span>)  )</span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a>    </span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> acceptance_ratio)</span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a>  {</span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a>      x[t] <span class="ot">&lt;-</span> x_proposed</span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a>      x[t] <span class="ot">&lt;-</span> x[t <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a>    }</span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a>  }</span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a>  </span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a>}</span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb25-31"><a href="#cb25-31" tabindex="-1"></a></span>
<span id="cb25-32"><a href="#cb25-32" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb25-33"><a href="#cb25-33" tabindex="-1"></a>sigma_proposal <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb25-34"><a href="#cb25-34" tabindex="-1"></a>chain <span class="ot">&lt;-</span> <span class="fu">metropolis_hastings_rayleigh</span>(n_samples, sigma_proposal)</span>
<span id="cb25-35"><a href="#cb25-35" tabindex="-1"></a></span>
<span id="cb25-36"><a href="#cb25-36" tabindex="-1"></a>num_chains <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb25-37"><a href="#cb25-37" tabindex="-1"></a></span>
<span id="cb25-38"><a href="#cb25-38" tabindex="-1"></a>chains <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>num_chains, <span class="cf">function</span>(i) <span class="fu">metropolis_hastings_rayleigh</span>(n_samples, sigma_proposal))</span>
<span id="cb25-39"><a href="#cb25-39" tabindex="-1"></a></span>
<span id="cb25-40"><a href="#cb25-40" tabindex="-1"></a>mcmc_chains <span class="ot">&lt;-</span> <span class="fu">lapply</span>(chains, as.mcmc)</span>
<span id="cb25-41"><a href="#cb25-41" tabindex="-1"></a></span>
<span id="cb25-42"><a href="#cb25-42" tabindex="-1"></a>mcmc_list <span class="ot">&lt;-</span> <span class="fu">mcmc.list</span>(mcmc_chains)</span>
<span id="cb25-43"><a href="#cb25-43" tabindex="-1"></a></span>
<span id="cb25-44"><a href="#cb25-44" tabindex="-1"></a>gelman_diag <span class="ot">&lt;-</span> <span class="fu">gelman.diag</span>(mcmc_list)</span>
<span id="cb25-45"><a href="#cb25-45" tabindex="-1"></a></span>
<span id="cb25-46"><a href="#cb25-46" tabindex="-1"></a><span class="fu">print</span>(gelman_diag)</span>
<span id="cb25-47"><a href="#cb25-47" tabindex="-1"></a><span class="do">## Potential scale reduction factors:</span></span>
<span id="cb25-48"><a href="#cb25-48" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb25-49"><a href="#cb25-49" tabindex="-1"></a><span class="do">##      Point est. Upper C.I.</span></span>
<span id="cb25-50"><a href="#cb25-50" tabindex="-1"></a><span class="do">## [1,]       1.02       1.04</span></span>
<span id="cb25-51"><a href="#cb25-51" tabindex="-1"></a></span>
<span id="cb25-52"><a href="#cb25-52" tabindex="-1"></a><span class="fu">gelman.plot</span>(mcmc_list)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>结果显示当sanple次数逐渐增大500以上时，<span class="math inline">\(R^2\)</span>会降到1.2以下，这表明我们构造的马尔可夫链最终是收敛的。</p>
</div>
</div>
<div id="homework-9" class="section level1">
<h1>Homework 9</h1>
<div id="question-1-7" class="section level2">
<h2>Question 1</h2>
<p>设<span class="math inline">\(X_1,...,X_n\)</span>服从参数为<span class="math inline">\(\lambda\)</span>的指数分布，因为某种原因，只知道<span class="math inline">\(X_i\)</span>存在于区间<span class="math inline">\([u_i,v_i]\)</span>，这两个数是已知常数，这种数据称为区间删失数据。</p>
<p>(1)请你分别采用EM算法和最大化似然函数求解<span class="math inline">\(\lambda\)</span>的MLE，并且证明EM算法在这种数据下是收敛的，并且是收敛速度是线性的.</p>
<p>(2)假设10个观测值数据为: <span class="math inline">\((11,12),(8,9),(27,28),(13,14),(16,17),(0,1),(23,24),(10,11),(24,25),(2,3)\)</span>，计算结果</p>
</div>
<div id="answer-1-5" class="section level2">
<h2>Answer 1</h2>
<ol style="list-style-type: lower-alpha">
<li>首先，我们考虑区间删失数据下的最大似然估计（MLE）问题。</li>
</ol>
<p>假设观测到的数据为<span class="math inline">\(X_1, X_2, \ldots,
X_n\)</span>，其中<span class="math inline">\(X_i\)</span>的真实取值存在于区间<span class="math inline">\([u_i, v_i]\)</span>。指数分布的概率密度函数为<span class="math inline">\(f(x;\lambda) = \lambda e^{-\lambda
x}\)</span>，其中<span class="math inline">\(\lambda\)</span>是指数分布的参数。对于区间删失数据，我们需要计算观测数据的似然函数。</p>
<p>似然函数为：</p>
<p><span class="math display">\[ L(\lambda) = \prod_{i=1}^{n} P(u_i \leq
X_i \leq v_i;\lambda) \]</span></p>
<p>由于<span class="math inline">\(X_i\)</span>在区间<span class="math inline">\([u_i,
v_i]\)</span>之间服从均匀分布，其概率为：</p>
<p><span class="math display">\[ P(u_i \leq X_i \leq v_i;\lambda) =
\int_{u_i}^{v_i} \lambda e^{-\lambda x} \,dx = \lambda e^{-\lambda u_i}
- \lambda e^{-\lambda v_i} \]</span></p>
<p>取对数似然函数为：</p>
<p><span class="math display">\[ \log L(\lambda) = \sum_{i=1}^{n} \log
(\lambda e^{-\lambda u_i} - \lambda e^{-\lambda v_i}) \]</span></p>
<p>最大化对数似然函数即求解以下方程：</p>
<p><span class="math display">\[ \frac{\partial \log
L(\lambda)}{\partial \lambda} = 0 \]</span></p>
<p>解得：</p>
<p><span class="math display">\[ \hat{\lambda}_{MLE} =
\frac{n}{\sum_{i=1}^{n} (v_i - u_i)} \]</span></p>
<p>接下来，我们考虑采用EM算法求解<span class="math inline">\(\lambda\)</span>的估计值。EM算法的迭代步骤如下：</p>
<ol style="list-style-type: decimal">
<li><p><strong>E步骤（Expectation Step）</strong>：计算给定当前参数<span class="math inline">\(\lambda\)</span>下观测数据的期望（隐变量的条件概率分布）。</p></li>
<li><p><strong>M步骤（Maximization
Step）</strong>：最大化在E步骤中计算的期望，得到新的参数<span class="math inline">\(\lambda\)</span>。</p></li>
</ol>
<p>对于指数分布，我们假设这其中的隐变量是<span class="math inline">\(X_i\)</span>具体的值，参数是<span class="math inline">\(\lambda\)</span>。</p>
<p>初始化<span class="math inline">\(\lambda_0=1\)</span>， -
E步:计算隐变量<span class="math inline">\(X_i\)</span>的期望，具体来说，<span class="math inline">\(X_i\)</span>服从区间<span class="math inline">\([u_i,v_i]\)</span>上截断的指数分布。</p>
<ul>
<li>M步：用<span class="math inline">\(X_1,...,X_n\)</span>作为样本，直接用极大似然方法估计<span class="math inline">\(\lambda\)</span>。</li>
</ul>
<p>由于EM算法的收敛性是已知结论，这是因为每一步迭代过程中对数似然都是单调递增的，收敛性易证。关于收敛速度：</p>
<p>EM算法的全局收敛速度定义为 <span class="math display">\[
\rho=\lim _{t \rightarrow \infty}
\frac{\left\|\theta^{(t+1)}-\hat{\theta}\right\|}{\left\|\theta^{(t)}-\hat{\theta}\right\|}
\]</span> <span class="math inline">\(\mathrm{EM}\)</span>
算法定义了一个映射 <span class="math inline">\(\theta^{(t+1)}=\Psi\left(\theta^{(t)}\right)\)</span>,
其中 <span class="math inline">\(\theta=\left(\theta_1, \ldots,
\theta_p\right), \Psi(\theta)=\)</span> <span class="math inline">\(\left(\Psi\left(\theta_1\right), \ldots,
\Psi\left(\theta_p\right)\right)\)</span>, 当 EM算法收玫时,
如果收敛到该映射的一个不动点, 那 么 <span class="math inline">\(\hat{\theta}=\Psi(\hat{\theta})\)</span>. 设 <span class="math inline">\(\Psi^{\prime}(\theta)\)</span> 表示其Jacobi矩阵,
其 <span class="math inline">\((i, j)\)</span> 元素为 <span class="math inline">\(\frac{\partial \Psi_i(\theta)}{\partial
\theta_j}\)</span>. 则有 <span class="math display">\[
\theta^{(t+1)}-\hat{\theta} \approx
\Psi^{\prime}\left(\theta^{(t)}\right)\left(\theta^{(t)}-\hat{\theta}\right)
\]</span></p>
<p>因此当 <span class="math inline">\(p=1\)</span> 时, <span class="math inline">\(\mathrm{EM}\)</span> 算法有线性收敛。若对 <span class="math inline">\(p&gt;1\)</span>, 若fisher信息阵 <span class="math inline">\(-l^{\prime \prime}(\hat{\theta} \mid x)\)</span>
是正定的, 则 收敛仍是线性的。</p>
<ol start="2" style="list-style-type: lower-alpha">
<li></li>
</ol>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># 观测数据</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">23</span>, <span class="dv">24</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">24</span>, <span class="dv">25</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="co"># EM算法</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">1</span>  </span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a><span class="cf">for</span> (iter <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {  </span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>  <span class="co"># E步</span></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>  E_values <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">nrow</span>(data))</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>   <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data)) {</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>    integrand <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>      x <span class="sc">*</span> lambda <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>lambda <span class="sc">*</span> x) <span class="sc">/</span> (<span class="fu">exp</span>(<span class="sc">-</span>lambda <span class="sc">*</span>data[i, <span class="dv">1</span>])<span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>lambda <span class="sc">*</span>data[i, <span class="dv">2</span>]))</span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>    }</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>    </span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>    E_values[i] <span class="ot">&lt;-</span> <span class="fu">integrate</span>(integrand, <span class="at">lower =</span> data[i, <span class="dv">1</span>], <span class="at">upper =</span> data[i, <span class="dv">2</span>])<span class="sc">$</span>value</span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>  }</span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a>  </span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a> </span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a>  </span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>  lambda_new <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">mean</span>(E_values)</span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a>  </span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">abs</span>(lambda_new <span class="sc">-</span> lambda) <span class="sc">&lt;</span> <span class="fl">1e-6</span>) {</span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> lambda_new</span>
<span id="cb26-27"><a href="#cb26-27" tabindex="-1"></a>  }</span>
<span id="cb26-28"><a href="#cb26-28" tabindex="-1"></a>}</span>
<span id="cb26-29"><a href="#cb26-29" tabindex="-1"></a></span>
<span id="cb26-30"><a href="#cb26-30" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;最大似然估计：&quot;</span>, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">mean</span>(data)))</span>
<span id="cb26-32"><a href="#cb26-32" tabindex="-1"></a><span class="do">## [1] &quot;最大似然估计： 0.0719424460431655&quot;</span></span>
<span id="cb26-33"><a href="#cb26-33" tabindex="-1"></a></span>
<span id="cb26-34"><a href="#cb26-34" tabindex="-1"></a></span>
<span id="cb26-35"><a href="#cb26-35" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;EM算法估计：&quot;</span>, lambda))</span>
<span id="cb26-36"><a href="#cb26-36" tabindex="-1"></a><span class="do">## [1] &quot;EM算法估计： 0.0719736704199017&quot;</span></span></code></pre></div>
</div>
<div id="question-2-2" class="section level2">
<h2>Question 2</h2>
<p>在 Morra 博弈中，如果常数为常数，则最优策略集不会改变
从支付矩阵的每个条目中减去一个正常数乘以支付矩阵的每个条目。
然而，单纯形 算法可能会在不同的基本可行点（也是最优的）处终止。计算 B
&lt;- A + 2，找到游戏 B 的解，并验证它是否原始游戏 A 的极值点
(11.12)–(11.15)。同时找到 游戏A和游戏B的价值</p>
</div>
<div id="answer-2-5" class="section level2">
<h2>Answer 2</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>solve.game <span class="ot">&lt;-</span> <span class="cf">function</span>(A) {</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a><span class="co">#solve the two player zero-sum game by simplex method</span></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="co">#optimize for player 1, then player 2</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="co">#maximize v subject to ...</span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="co">#let x strategies 1:m, and put v as extra variable</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a><span class="co">#A1, the &lt;= constraints</span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a>min.A <span class="ot">&lt;-</span> <span class="fu">min</span>(A)</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>A <span class="ot">&lt;-</span> A <span class="sc">-</span> min.A <span class="co">#so that v &gt;= 0</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>max.A <span class="ot">&lt;-</span> <span class="fu">max</span>(A)</span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>A <span class="ot">&lt;-</span> A <span class="sc">/</span> <span class="fu">max</span>(A)</span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">nrow</span>(A)</span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(A)</span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a>it <span class="ot">&lt;-</span> n<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, m), <span class="dv">1</span>) <span class="co">#objective function</span></span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">cbind</span>(<span class="fu">t</span>(A), <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>, n)) <span class="co">#constraints &lt;=</span></span>
<span id="cb27-20"><a href="#cb27-20" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb27-21"><a href="#cb27-21" tabindex="-1"></a>A3 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, m), <span class="dv">0</span>))) <span class="co">#constraints sum(x)=1</span></span>
<span id="cb27-22"><a href="#cb27-22" tabindex="-1"></a>b3 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb27-23"><a href="#cb27-23" tabindex="-1"></a>sx <span class="ot">&lt;-</span> <span class="fu">simplex</span>(<span class="at">a=</span>a, <span class="at">A1=</span>A1, <span class="at">b1=</span>b1, <span class="at">A3=</span>A3, <span class="at">b3=</span>b3,</span>
<span id="cb27-24"><a href="#cb27-24" tabindex="-1"></a><span class="at">maxi=</span><span class="cn">TRUE</span>, <span class="at">n.iter=</span>it)</span>
<span id="cb27-25"><a href="#cb27-25" tabindex="-1"></a><span class="co">#the ’solution’ is [x1,x2,...,xm | value of game]</span></span>
<span id="cb27-26"><a href="#cb27-26" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb27-27"><a href="#cb27-27" tabindex="-1"></a><span class="co">#minimize v subject to ...</span></span>
<span id="cb27-28"><a href="#cb27-28" tabindex="-1"></a><span class="co">#let y strategies 1:n, with v as extra variable</span></span>
<span id="cb27-29"><a href="#cb27-29" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, n), <span class="dv">1</span>) <span class="co">#objective function</span></span>
<span id="cb27-30"><a href="#cb27-30" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(A, <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>, m)) <span class="co">#constraints &lt;=</span></span>
<span id="cb27-31"><a href="#cb27-31" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, m)</span>
<span id="cb27-32"><a href="#cb27-32" tabindex="-1"></a>A3 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, n), <span class="dv">0</span>))) <span class="co">#constraints sum(y)=1</span></span>
<span id="cb27-33"><a href="#cb27-33" tabindex="-1"></a>b3 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb27-34"><a href="#cb27-34" tabindex="-1"></a>sy <span class="ot">&lt;-</span> <span class="fu">simplex</span>(<span class="at">a=</span>a, <span class="at">A1=</span>A1, <span class="at">b1=</span>b1, <span class="at">A3=</span>A3, <span class="at">b3=</span>b3,</span>
<span id="cb27-35"><a href="#cb27-35" tabindex="-1"></a><span class="at">maxi=</span><span class="cn">FALSE</span>, <span class="at">n.iter=</span>it)</span>
<span id="cb27-36"><a href="#cb27-36" tabindex="-1"></a>soln <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;A&quot;</span> <span class="ot">=</span> A <span class="sc">*</span> max.A <span class="sc">+</span> min.A,</span>
<span id="cb27-37"><a href="#cb27-37" tabindex="-1"></a><span class="st">&quot;x&quot;</span> <span class="ot">=</span> sx<span class="sc">$</span>soln[<span class="dv">1</span><span class="sc">:</span>m],</span>
<span id="cb27-38"><a href="#cb27-38" tabindex="-1"></a><span class="st">&quot;y&quot;</span> <span class="ot">=</span> sy<span class="sc">$</span>soln[<span class="dv">1</span><span class="sc">:</span>n],</span>
<span id="cb27-39"><a href="#cb27-39" tabindex="-1"></a><span class="st">&quot;v&quot;</span> <span class="ot">=</span> sx<span class="sc">$</span>soln[m<span class="sc">+</span><span class="dv">1</span>] <span class="sc">*</span> max.A <span class="sc">+</span> min.A)</span>
<span id="cb27-40"><a href="#cb27-40" tabindex="-1"></a>soln</span>
<span id="cb27-41"><a href="#cb27-41" tabindex="-1"></a>}</span>
<span id="cb27-42"><a href="#cb27-42" tabindex="-1"></a></span>
<span id="cb27-43"><a href="#cb27-43" tabindex="-1"></a></span>
<span id="cb27-44"><a href="#cb27-44" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>( <span class="dv">0</span>,<span class="sc">-</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb27-45"><a href="#cb27-45" tabindex="-1"></a><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb27-46"><a href="#cb27-46" tabindex="-1"></a><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="sc">-</span><span class="dv">4</span>,</span>
<span id="cb27-47"><a href="#cb27-47" tabindex="-1"></a><span class="sc">-</span><span class="dv">3</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,</span>
<span id="cb27-48"><a href="#cb27-48" tabindex="-1"></a><span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,</span>
<span id="cb27-49"><a href="#cb27-49" tabindex="-1"></a><span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">5</span>,</span>
<span id="cb27-50"><a href="#cb27-50" tabindex="-1"></a><span class="sc">-</span><span class="dv">4</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">6</span>,</span>
<span id="cb27-51"><a href="#cb27-51" tabindex="-1"></a><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">6</span>,</span>
<span id="cb27-52"><a href="#cb27-52" tabindex="-1"></a><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="sc">-</span><span class="dv">6</span>,<span class="sc">-</span><span class="dv">6</span>,<span class="dv">0</span>), <span class="dv">9</span>, <span class="dv">9</span>)</span>
<span id="cb27-53"><a href="#cb27-53" tabindex="-1"></a></span>
<span id="cb27-54"><a href="#cb27-54" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">solve.game</span>(A<span class="sc">+</span><span class="dv">2</span>)</span>
<span id="cb27-55"><a href="#cb27-55" tabindex="-1"></a></span>
<span id="cb27-56"><a href="#cb27-56" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">cbind</span>(s<span class="sc">$</span>x, s<span class="sc">$</span>y), <span class="dv">7</span>)</span></code></pre></div>
<pre><code>##         [,1]      [,2]
## x1 0.0000000 0.0000000
## x2 0.0000000 0.0000000
## x3 0.4098361 0.4098361
## x4 0.0000000 0.0000000
## x5 0.3278689 0.3278689
## x6 0.0000000 0.0000000
## x7 0.2622951 0.2622951
## x8 0.0000000 0.0000000
## x9 0.0000000 0.0000000</code></pre>
<p>正如题所说，在给pay-off矩阵加减上常数后，不影响结果，并且极值点也不变。极值点仍为
<span class="math inline">\((0, 0, 5/12, 0, 4/12, 0, 3/12, 0,
0)\)</span>, <span class="math inline">\((0, 0, 16/37, 0, 12/37, 0,
9/37, 0, 0)\)</span>, <span class="math inline">\((0, 0, 20/47, 0,
15/47, 0, 12/47, 0, 0)\)</span>, <span class="math inline">\((0, 0,
25/61, 0, 20/61, 0, 16/61, 0, 0)\)</span>.</p>
</div>
</div>
<div id="homework-10" class="section level1">
<h1>Homework 10</h1>
<div id="question-1-8" class="section level2">
<h2>Question 1</h2>
<p>在R语言中，为什么需要使用unlist()将列表转换为原子 向量？ 为什么
as.vector() 不起作用？</p>
</div>
<div id="answer-1-6" class="section level2">
<h2>Answer 1</h2>
<p>在R语言中，unlist()函数和as.vector()函数都可以用于将列表（list）转换为原子向量（atomic
vector）。但是，它们的行为有所不同。</p>
<p>unlist()函数用于将列表的所有元素递归展开成一个原子向量。如果列表中有嵌套的子列表，unlist()会将其递归展开为一个平铺的原子向量。这意味着，如果列表结构比较复杂，unlist()可以将其一维化。</p>
<p>而as.vector()函数的行为取决于输入的对象。如果输入的对象是一个原子向量，它会返回相同的原子向量。但是，如果输入的对象是一个列表，as.vector()并不会递归展开列表，而是返回一个仍然是列表的原子向量，并不会展开原子列表。</p>
</div>
<div id="question-2-3" class="section level2">
<h2>Question 2</h2>
<p>应用于向量时，dim() 返回什么？</p>
</div>
<div id="answer-2-6" class="section level2">
<h2>Answer 2</h2>
<p>在 R 中，dim() 函数用于获取或设置数组、矩阵或数据框的维度。
当应用于可被视为一维数组的向量时，dim() 返回 NULL。</p>
<p>这是一个例子:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>my_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>dimensions <span class="ot">&lt;-</span> <span class="fu">dim</span>(my_vector)</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a><span class="fu">print</span>(dimensions)</span></code></pre></div>
<pre><code>## NULL</code></pre>
</div>
<div id="question-3-3" class="section level2">
<h2>Question 3</h2>
<p>如果 is.matrix(x) 为 TRUE，is.array(x) 将返回什么？</p>
</div>
<div id="answer-3-3" class="section level2">
<h2>Answer 3</h2>
<p>在R语言中，is.array(x)
也将返回TRUE。因为在R中矩阵是数组的一种特殊类型，其维度为2。</p>
</div>
<div id="qusetion-4" class="section level2">
<h2>Qusetion 4</h2>
<p>当将 as.matrix() 应用于数据框时，它会做什么针对不同类型的列？</p>
</div>
<div id="answer-4-1" class="section level2">
<h2>Answer 4</h2>
<p>as.matrix()
会尽量将数据框的列转换为统一的类型，通常是数值型或字符型。并且按照这样的变量等级取这些变量类型中的最高级：
<span class="math display">\[
logical &lt; integer &lt; double &lt; character &lt; list
\]</span> 例如：</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">a =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">b =</span> <span class="fu">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;orange&quot;</span>))</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>my_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(my_df)</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="fu">str</span>(my_matrix)</span></code></pre></div>
<pre><code>##  chr [1:3, 1:2] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;apple&quot; &quot;banana&quot; &quot;orange&quot;
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr [1:2] &quot;a&quot; &quot;b&quot;</code></pre>
</div>
<div id="question-5-2" class="section level2">
<h2>Question 5</h2>
<p>你可以有一个 0 行的数据框吗？ 0列呢？</p>
</div>
<div id="answer-5-2" class="section level2">
<h2>Answer 5</h2>
<p>是可以的。</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># 创建一个0行的数据框</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>empty_df_rows <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="co"># 打印结果</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="fu">print</span>(empty_df_rows)</span></code></pre></div>
<pre><code>## data frame with 0 columns and 0 rows</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># 创建一个0列的数据框</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>empty_df_cols <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">0</span>))</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a><span class="co"># 打印结果</span></span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a><span class="fu">print</span>(empty_df_cols)</span></code></pre></div>
<pre><code>## data frame with 0 columns and 1 row</code></pre>
</div>
<div id="question-6-1" class="section level2">
<h2>Question 6</h2>
</div>
<div id="answer-6-1" class="section level2">
<h2>Answer 6</h2>
<p>如果只是想对每个列使用scale函数，用apply函数即可。如果想将 scale01
函数仅应用于数据框中的数值型列变量，可以使用 dplyr 包的 mutate_if
函数：</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>scale01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>  rng <span class="ot">&lt;-</span> <span class="fu">range</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>  (x <span class="sc">-</span> rng[<span class="dv">1</span>]) <span class="sc">/</span> (rng[<span class="dv">2</span>] <span class="sc">-</span> rng[<span class="dv">1</span>])</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>}</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a>  <span class="at">A =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>  <span class="at">B =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a>  <span class="at">C =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)</span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a>)</span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a><span class="co"># 使用 apply 函数应用 scale01 到每一列</span></span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a>scaled_df <span class="ot">&lt;-</span> <span class="fu">apply</span>(my_df, <span class="dv">2</span>, scale01)</span>
<span id="cb37-15"><a href="#cb37-15" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" tabindex="-1"></a><span class="fu">print</span>(scaled_df)</span></code></pre></div>
<pre><code>##        A   B   C
## [1,] 0.0 0.0 0.0
## [2,] 0.5 0.5 0.5
## [3,] 1.0 1.0 1.0</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>  <span class="at">A =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>  <span class="at">B =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>  <span class="at">C =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>),</span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>  <span class="at">D =</span> <span class="fu">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;orange&quot;</span>),</span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a>  <span class="at">E =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a>)</span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" tabindex="-1"></a>scaled_df <span class="ot">&lt;-</span> my_df <span class="sc">%&gt;%</span></span>
<span id="cb43-11"><a href="#cb43-11" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, scale01)</span>
<span id="cb43-12"><a href="#cb43-12" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" tabindex="-1"></a><span class="fu">print</span>(scaled_df)</span></code></pre></div>
<pre><code>##     A   B   C      D     E
## 1 0.0 0.0 0.0  apple  TRUE
## 2 0.5 0.5 0.5 banana FALSE
## 3 1.0 1.0 1.0 orange  TRUE</code></pre>
</div>
<div id="question-7" class="section level2">
<h2>Question 7</h2>
<p>使用 vapply() 完成： a) 计算数值数据框中每列的标准差。 b)
计算每个数字列的标准差 在混合数据框中。</p>
</div>
<div id="answer-7" class="section level2">
<h2>Answer 7</h2>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>numeric_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>  <span class="at">A =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>  <span class="at">B =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>  <span class="at">C =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)</span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a>)</span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a>std_devs <span class="ot">&lt;-</span> <span class="fu">vapply</span>(numeric_df, sd, <span class="fu">numeric</span>(<span class="dv">1</span>))</span>
<span id="cb45-8"><a href="#cb45-8" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" tabindex="-1"></a><span class="fu">print</span>(std_devs)</span></code></pre></div>
<pre><code>## A B C 
## 1 1 1</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a>mixed_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a>  <span class="at">A =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a>  <span class="at">B =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a>  <span class="at">C =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>),</span>
<span id="cb47-5"><a href="#cb47-5" tabindex="-1"></a>  <span class="at">D =</span> <span class="fu">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;orange&quot;</span>),</span>
<span id="cb47-6"><a href="#cb47-6" tabindex="-1"></a>  <span class="at">E =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb47-7"><a href="#cb47-7" tabindex="-1"></a>)</span>
<span id="cb47-8"><a href="#cb47-8" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" tabindex="-1"></a>numeric_std_devs <span class="ot">&lt;-</span> <span class="fu">vapply</span>(mixed_df, <span class="cf">function</span>(x) <span class="cf">if</span>(<span class="fu">is.numeric</span>(x)) <span class="fu">sd</span>(x) <span class="cf">else</span> <span class="cn">NA</span>, <span class="fu">numeric</span>(<span class="dv">1</span>))</span>
<span id="cb47-11"><a href="#cb47-11" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" tabindex="-1"></a><span class="fu">print</span>(numeric_std_devs)</span></code></pre></div>
<pre><code>##  A  B  C  D  E 
##  1  1  1 NA NA</code></pre>
</div>
<div id="question-8" class="section level2">
<h2>Question 8</h2>
<p>考虑练习 9.8</p>
<p>• 编写一个R 函数。 • 编写Rcpp 函数。 •
将两个函数的计算时间与函数“microbenchmark”进行比较</p>
<p>其中，练习9.8的题目是： 考虑双变量密度 <span class="math display">\[
f(x, y) = y^{x+a-1}(1-y)^{n-x+b-1}, \quad x=0,1, \ldots, n, 0 \leq y
\leq 1 。
\]</span></p>
<p>对于固定的 <span class="math inline">\(a, b, n\)</span>，条件分布为
<span class="math inline">\(\operatorname{Binomial}(n, y)\)</span> 和
<span class="math inline">\(\operatorname{Beta}(x+a, n-x+b)\)</span>。
使用吉布斯采样器生成目标联合密度 <span class="math inline">\(f(x,
y)\)</span> 的链。</p>
</div>
<div id="answer-8" class="section level2">
<h2>Answer 8</h2>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="co"># 安装并加载 microbenchmark 包</span></span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a><span class="co"># install.packages(&quot;microbenchmark&quot;)</span></span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a><span class="fu">library</span>(microbenchmark)</span>
<span id="cb49-4"><a href="#cb49-4" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" tabindex="-1"></a><span class="co"># 定义R函数</span></span>
<span id="cb49-6"><a href="#cb49-6" tabindex="-1"></a>gibbs_sampler_R <span class="ot">&lt;-</span> <span class="cf">function</span>(n, a, b, iterations) {</span>
<span id="cb49-7"><a href="#cb49-7" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(iterations)</span>
<span id="cb49-8"><a href="#cb49-8" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">numeric</span>(iterations)</span>
<span id="cb49-9"><a href="#cb49-9" tabindex="-1"></a>  </span>
<span id="cb49-10"><a href="#cb49-10" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iterations) {</span>
<span id="cb49-11"><a href="#cb49-11" tabindex="-1"></a>    <span class="co"># 从条件分布中采样</span></span>
<span id="cb49-12"><a href="#cb49-12" tabindex="-1"></a>    <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb49-13"><a href="#cb49-13" tabindex="-1"></a>    {</span>
<span id="cb49-14"><a href="#cb49-14" tabindex="-1"></a>      s<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb49-15"><a href="#cb49-15" tabindex="-1"></a>    }</span>
<span id="cb49-16"><a href="#cb49-16" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb49-17"><a href="#cb49-17" tabindex="-1"></a>      s<span class="ot">&lt;-</span>x[i<span class="dv">-1</span>]</span>
<span id="cb49-18"><a href="#cb49-18" tabindex="-1"></a>    }</span>
<span id="cb49-19"><a href="#cb49-19" tabindex="-1"></a>    y[i] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, s <span class="sc">+</span> a, n <span class="sc">-</span> s <span class="sc">+</span> b)</span>
<span id="cb49-20"><a href="#cb49-20" tabindex="-1"></a>    x[i] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, y[i])</span>
<span id="cb49-21"><a href="#cb49-21" tabindex="-1"></a>  }</span>
<span id="cb49-22"><a href="#cb49-22" tabindex="-1"></a>  </span>
<span id="cb49-23"><a href="#cb49-23" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(x, y))</span>
<span id="cb49-24"><a href="#cb49-24" tabindex="-1"></a>}</span>
<span id="cb49-25"><a href="#cb49-25" tabindex="-1"></a></span>
<span id="cb49-26"><a href="#cb49-26" tabindex="-1"></a><span class="co"># 运行 microbenchmark 比较计算时间</span></span>
<span id="cb49-27"><a href="#cb49-27" tabindex="-1"></a>result_R <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(<span class="fu">gibbs_sampler_R</span>(<span class="dv">10</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1000</span>))</span>
<span id="cb49-28"><a href="#cb49-28" tabindex="-1"></a><span class="fu">print</span>(result_R)</span></code></pre></div>
<pre><code>## Unit: milliseconds
##                             expr      min       lq     mean   median       uq
##  gibbs_sampler_R(10, 2, 3, 1000) 2.935401 3.092251 4.439917 3.347151 4.940351
##      max neval
##  11.5988   100</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="fu">library</span>(Rcpp)</span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a><span class="fu">sourceCpp</span>(<span class="at">code=</span><span class="st">&#39;</span></span>
<span id="cb51-3"><a href="#cb51-3" tabindex="-1"></a><span class="st">#include &lt;Rcpp.h&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" tabindex="-1"></a><span class="st">using namespace Rcpp;</span></span>
<span id="cb51-5"><a href="#cb51-5" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" tabindex="-1"></a><span class="st">// [[Rcpp::export]]</span></span>
<span id="cb51-8"><a href="#cb51-8" tabindex="-1"></a><span class="st">NumericMatrix gibbs_sampler_Rcpp(int n, double a, double b, int iterations)</span></span>
<span id="cb51-9"><a href="#cb51-9" tabindex="-1"></a><span class="st">{</span></span>
<span id="cb51-10"><a href="#cb51-10" tabindex="-1"></a><span class="st">  NumericVector x(iterations);</span></span>
<span id="cb51-11"><a href="#cb51-11" tabindex="-1"></a><span class="st">  NumericVector y(iterations);</span></span>
<span id="cb51-12"><a href="#cb51-12" tabindex="-1"></a><span class="st">  NumericMatrix out_stat(iterations,2);</span></span>
<span id="cb51-13"><a href="#cb51-13" tabindex="-1"></a><span class="st">  double s;</span></span>
<span id="cb51-14"><a href="#cb51-14" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" tabindex="-1"></a><span class="st">  for (int i = 0; i &lt; iterations; i++) {</span></span>
<span id="cb51-16"><a href="#cb51-16" tabindex="-1"></a><span class="st">    if(i==0)</span></span>
<span id="cb51-17"><a href="#cb51-17" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb51-18"><a href="#cb51-18" tabindex="-1"></a><span class="st">      s=0;</span></span>
<span id="cb51-19"><a href="#cb51-19" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb51-20"><a href="#cb51-20" tabindex="-1"></a><span class="st">    else</span></span>
<span id="cb51-21"><a href="#cb51-21" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb51-22"><a href="#cb51-22" tabindex="-1"></a><span class="st">      s=x(i-1);</span></span>
<span id="cb51-23"><a href="#cb51-23" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb51-24"><a href="#cb51-24" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb51-25"><a href="#cb51-25" tabindex="-1"></a><span class="st">    y(i) = R::rbeta(s + a, n - s + b);</span></span>
<span id="cb51-26"><a href="#cb51-26" tabindex="-1"></a><span class="st">    x(i) = R::rbinom( n, y(i));</span></span>
<span id="cb51-27"><a href="#cb51-27" tabindex="-1"></a><span class="st">    out_stat(i,0) = x(i);</span></span>
<span id="cb51-28"><a href="#cb51-28" tabindex="-1"></a><span class="st">    out_stat(i,1) = y(i);</span></span>
<span id="cb51-29"><a href="#cb51-29" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb51-30"><a href="#cb51-30" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb51-31"><a href="#cb51-31" tabindex="-1"></a><span class="st">  return out_stat;</span></span>
<span id="cb51-32"><a href="#cb51-32" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb51-33"><a href="#cb51-33" tabindex="-1"></a><span class="st">&#39;</span>)</span>
<span id="cb51-34"><a href="#cb51-34" tabindex="-1"></a></span>
<span id="cb51-35"><a href="#cb51-35" tabindex="-1"></a><span class="co"># 运行 microbenchmark 比较计算时间</span></span>
<span id="cb51-36"><a href="#cb51-36" tabindex="-1"></a>result_Rcpp <span class="ot">&lt;-</span> microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(<span class="fu">gibbs_sampler_Rcpp</span>(<span class="dv">10</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1000</span>))</span>
<span id="cb51-37"><a href="#cb51-37" tabindex="-1"></a><span class="fu">print</span>(result_Rcpp)</span></code></pre></div>
<pre><code>## Unit: microseconds
##                                expr     min       lq    mean   median       uq
##  gibbs_sampler_Rcpp(10, 2, 3, 1000) 239.201 249.1015 288.876 256.6505 274.9515
##       max neval
##  2247.401   100</code></pre>
<p>我们发现使用Rcpp的结果平均数是200微秒左右，使用R的结果是5毫秒左右。平均运行速度上，使用Rcpp编译为C++文件运行的速度快了几十倍。</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
